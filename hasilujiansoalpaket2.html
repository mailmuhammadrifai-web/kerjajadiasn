<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hasil Simulasi - Kerja Jadi ASN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* CSS styles tetap sama seperti sebelumnya */
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes scoreIncrement {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        @keyframes confettiFall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(1000px) rotate(360deg); opacity: 0; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .animate-fadeIn {
            animation: fadeIn 0.6s ease-out;
        }

        .animate-score {
            animation: scoreIncrement 1s ease-out;
        }

        .animate-pulse-slow {
            animation: pulse 2s infinite;
        }

        .progress-bar {
            transition: width 1.5s ease-in-out;
        }

        .score-ring {
            transform: rotate(-90deg);
        }

        .score-ring-circle {
            transition: stroke-dasharray 1.5s ease-in-out;
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        @media print {
            .no-print {
                display: none !important;
            }
            body {
                background: white !important;
                color: black !important;
            }
            .glass-effect {
                background: white !important;
                backdrop-filter: none !important;
                border: 1px solid #ddd !important;
            }
            .shadow-*, .shadow-* {
                box-shadow: none !important;
            }
        }

        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="min-h-screen pb-20">

    <!-- Confetti Container -->
    <div id="confetti-container" class="fixed inset-0 pointer-events-none z-0"></div>

    <!-- Notification Toast -->
    <div id="notification-toast" class="fixed top-4 right-4 z-50 hidden">
        <div class="bg-white rounded-xl shadow-lg border border-slate-200 p-4 max-w-sm animate-fadeIn">
            <div class="flex items-start gap-3">
                <div id="toast-icon" class="text-xl"></div>
                <div class="flex-1">
                    <h4 id="toast-title" class="font-bold text-slate-800"></h4>
                    <p id="toast-message" class="text-sm text-slate-600 mt-1"></p>
                </div>
                <button onclick="hideToast()" class="text-slate-400 hover:text-slate-600">
                    <i class="fa-solid fa-times"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div id="shareModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white rounded-2xl w-full max-w-md overflow-hidden">
            <div class="p-6 border-b border-slate-200">
                <h3 class="text-xl font-bold text-slate-800">Bagikan Hasil</h3>
                <p class="text-sm text-slate-600 mt-1">Bagikan hasil ujian Anda dengan teman atau mentor</p>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-2 gap-3 mb-6">
                    <button onclick="shareToWhatsApp()" class="p-4 bg-green-50 hover:bg-green-100 rounded-xl border border-green-200 flex flex-col items-center justify-center gap-2 transition-colors">
                        <i class="fab fa-whatsapp text-green-600 text-2xl"></i>
                        <span class="text-sm font-bold text-green-700">WhatsApp</span>
                    </button>
                    <button onclick="shareToFacebook()" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-xl border border-blue-200 flex flex-col items-center justify-center gap-2 transition-colors">
                        <i class="fab fa-facebook text-blue-600 text-2xl"></i>
                        <span class="text-sm font-bold text-blue-700">Facebook</span>
                    </button>
                    <button onclick="shareToTwitter()" class="p-4 bg-sky-50 hover:bg-sky-100 rounded-xl border border-sky-200 flex flex-col items-center justify-center gap-2 transition-colors">
                        <i class="fab fa-twitter text-sky-600 text-2xl"></i>
                        <span class="text-sm font-bold text-sky-700">Twitter</span>
                    </button>
                    <button onclick="copyResultLink()" class="p-4 bg-purple-50 hover:bg-purple-100 rounded-xl border border-purple-200 flex flex-col items-center justify-center gap-2 transition-colors">
                        <i class="fa-solid fa-link text-purple-600 text-2xl"></i>
                        <span class="text-sm font-bold text-purple-700">Salin Link</span>
                    </button>
                </div>
                <div class="mt-4 p-4 bg-slate-50 rounded-xl border border-slate-200">
                    <label class="text-sm font-medium text-slate-700 mb-2 block">Pesan Kustom</label>
                    <textarea id="shareMessage" rows="3" class="w-full p-3 border border-slate-300 rounded-lg text-sm resize-none" placeholder="Tambahkan pesan Anda...">Saya baru saja menyelesaikan simulasi CAT CPNS dengan skor yang memuaskan!</textarea>
                </div>
                <div class="mt-6 flex gap-3">
                    <button onclick="hideShareModal()" class="flex-1 px-4 py-3 bg-slate-100 text-slate-700 font-bold rounded-xl hover:bg-slate-200 transition-colors">
                        Batal
                    </button>
                    <button onclick="shareResult()" class="flex-1 px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold rounded-xl hover:from-blue-700 hover:to-indigo-700 transition-all">
                        Bagikan
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Analysis Modal -->
    <div id="analysisModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden">
            <div class="sticky top-0 bg-white border-b border-slate-200 p-6 flex justify-between items-center">
                <div>
                    <h3 class="text-xl font-bold text-slate-800">Analisis Detail Hasil</h3>
                    <p class="text-sm text-slate-500">PIN: <span id="analysisPin" class="font-mono font-bold"></span> | Paket: <span id="analysisPaket" class="font-bold"></span></p>
                </div>
                <button onclick="hideAnalysisModal()" class="text-slate-400 hover:text-slate-600 text-xl">
                    <i class="fa-solid fa-times"></i>
                </button>
            </div>
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
                <div id="analysisContent"></div>
            </div>
        </div>
    </div>

    <nav class="bg-white border-b border-slate-200 sticky top-0 z-40 shadow-sm glass-effect">
        <div class="container mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg flex items-center justify-center">
                        <i class="fa-solid fa-chart-line text-white"></i>
                    </div>
                    <div>
                        <h1 class="font-extrabold text-blue-600 text-lg md:text-xl">
                            KERJA JADI <span class="text-yellow-500">ASN</span>
                        </h1>
                        <p class="text-[10px] text-slate-500 font-bold uppercase tracking-wider">
                            Paket <span id="paketNumber">-</span> ‚Ä¢ PIN: <span id="displayPaketPin" class="font-mono">MEMUAT...</span>
                        </p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <div class="text-right hidden md:block">
                        <p class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">PIN Peserta</p>
                        <p id="displayPin" class="text-sm font-black text-slate-800 tracking-wide font-mono">MEMUAT...</p>
                    </div>
                    <div class="relative">
                        <button onclick="toggleResultMenu()" class="w-10 h-10 rounded-full bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-100 flex items-center justify-center hover:shadow-md transition-all">
                            <i class="fa-solid fa-ellipsis-vertical text-blue-600"></i>
                        </button>
                        <div id="resultMenu" class="absolute right-0 top-12 w-48 bg-white rounded-xl shadow-lg border border-slate-200 py-2 hidden z-50 animate-fadeIn">
                            <button onclick="showShareModal()" class="flex items-center gap-3 px-4 py-2 text-sm text-slate-700 hover:bg-blue-50 hover:text-blue-600 transition-colors w-full text-left">
                                <i class="fa-solid fa-share w-5 text-green-500"></i> Bagikan Hasil
                            </button>
                            <button onclick="showAnalysisModal()" class="flex items-center gap-3 px-4 py-2 text-sm text-slate-700 hover:bg-blue-50 hover:text-blue-600 transition-colors w-full text-left">
                                <i class="fa-solid fa-chart-bar w-5 text-purple-500"></i> Analisis Detail
                            </button>
                            <button onclick="downloadCertificate()" class="flex items-center gap-3 px-4 py-2 text-sm text-slate-700 hover:bg-blue-50 hover:text-blue-600 transition-colors w-full text-left">
                                <i class="fa-solid fa-certificate w-5 text-yellow-500"></i> Sertifikat
                            </button>
                            <div class="border-t border-slate-100 my-1"></div>
                            <button onclick="printResult()" class="flex items-center gap-3 px-4 py-2 text-sm text-slate-700 hover:bg-blue-50 hover:text-blue-600 transition-colors w-full text-left">
                                <i class="fa-solid fa-print w-5 text-slate-500"></i> Cetak Hasil
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-4 mt-6 md:mt-8 max-w-6xl">
        <!-- Loading State -->
        <div id="loadingState" class="text-center py-12">
            <div class="inline-block animate-spin rounded-full h-16 w-16 border-4 border-blue-600 border-t-transparent"></div>
            <p class="mt-6 text-lg font-bold text-slate-700">Memproses hasil ujian Anda...</p>
            <p class="mt-2 text-sm text-slate-500">Sedang menganalisis data dan menghitung skor</p>
        </div>

        <!-- Error State -->
        <div id="errorState" class="hidden text-center py-12">
            <div class="w-20 h-20 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fa-solid fa-triangle-exclamation text-red-500 text-3xl"></i>
            </div>
            <h3 class="text-xl font-bold text-slate-800 mb-2">Data Hasil Tidak Ditemukan</h3>
            <p class="text-slate-600 mb-6 max-w-md mx-auto">Tidak dapat menemukan data hasil ujian untuk PIN Anda. Mungkin sesi telah berakhir atau data telah dihapus.</p>
            <div class="flex gap-3 justify-center">
                <button onclick="kembaliDashboard()" class="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-blue-700 transition-colors">
                    Kembali ke Dashboard
                </button>
                <button onclick="location.reload()" class="bg-slate-100 text-slate-700 px-6 py-3 rounded-xl font-bold hover:bg-slate-200 transition-colors">
                    Coba Lagi
                </button>
            </div>
        </div>

        <!-- Success State -->
        <div id="successState" class="hidden animate-fadeIn">
            <!-- Header Section -->
            <div class="bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 rounded-2xl md:rounded-[2.5rem] p-6 md:p-8 shadow-2xl shadow-blue-100/50 border border-white/20 mb-8 relative overflow-hidden">
                <div class="relative z-10">
                    <div id="statusBadge" class="inline-flex items-center gap-2 px-6 py-2 rounded-full font-black text-xs uppercase tracking-[0.2em] mb-4 transition-colors duration-500 animate-pulse-slow"></div>
                    <h2 class="text-white/80 font-bold uppercase text-xs tracking-widest mb-2">Total Skor Anda</h2>
                    <div id="totalSkor" class="text-6xl md:text-7xl font-black text-white mb-6 animate-score">0</div>
                    <div class="flex flex-col md:flex-row items-center justify-between gap-6">
                        <div class="text-center md:text-left">
                            <p id="pesanKelulusan" class="text-white/90 text-sm md:text-base max-w-md leading-relaxed"></p>
                            <div class="mt-4 flex items-center justify-center md:justify-start gap-2 text-white/70">
                                <i class="fa-solid fa-clock"></i>
                                <span class="text-sm" id="waktuPengerjaan">-</span>
                            </div>
                        </div>
                        <div class="hidden md:block">
                            <div class="w-32 h-32 relative">
                                <svg class="w-full h-full score-ring" viewBox="0 0 36 36">
                                    <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="3"/>
                                    <path id="totalScoreRing" class="score-ring-circle" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="white" stroke-width="3" stroke-dasharray="0, 100" stroke-linecap="round"/>
                                </svg>
                                <div class="absolute inset-0 flex flex-col items-center justify-center">
                                    <span id="scorePercentage" class="text-2xl font-black text-white">0%</span>
                                    <span class="text-xs text-white/70">dari maksimal</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="absolute top-0 left-0 w-full h-full overflow-hidden">
                    <div class="absolute -top-20 -left-20 w-60 h-60 bg-white/10 rounded-full blur-3xl"></div>
                    <div class="absolute -bottom-20 -right-20 w-60 h-60 bg-purple-400/20 rounded-full blur-3xl"></div>
                </div>
                <i class="fa-solid fa-trophy absolute bottom-4 right-4 text-8xl text-white/10 hidden md:block"></i>
            </div>

            <!-- Stats Grid (TWK, TIU, TKP cards - tetap sama) -->
            <div class="grid md:grid-cols-3 gap-4 md:gap-6 mb-8">
                <!-- TWK Card -->
                <div class="bg-white p-5 md:p-6 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex items-center gap-2">
                            <div class="w-8 h-8 bg-gradient-to-r from-blue-100 to-blue-200 rounded-lg flex items-center justify-center">
                                <i class="fa-solid fa-landmark text-blue-600"></i>
                            </div>
                            <div>
                                <span class="text-xs font-black text-blue-600 uppercase">TWK</span>
                                <p class="text-[10px] font-bold text-slate-400 uppercase">Wawasan Kebangsaan</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="text-[10px] font-bold text-slate-400">Passing Grade</span>
                            <div class="text-xs font-black text-slate-800">65</div>
                        </div>
                    </div>
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-1">
                            <span id="skorTWK" class="text-3xl md:text-4xl font-black text-slate-800 animate-score">0</span>
                            <span id="statusTWK" class="text-[10px] font-bold uppercase tracking-wider px-3 py-1 rounded-full"></span>
                        </div>
                        <div class="text-xs text-slate-500">
                            <span id="twkInfo">0 dari 30 soal</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="flex justify-between text-xs text-slate-500 mb-1">
                            <span>Progress</span>
                            <span id="twkProgressText">0%</span>
                        </div>
                        <div class="w-full bg-slate-100 h-2 rounded-full overflow-hidden">
                            <div id="progressTWK" class="h-full bg-gradient-to-r from-blue-500 to-blue-600 progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-2 text-xs">
                        <div class="bg-blue-50 rounded-lg p-2 text-center">
                            <div class="font-bold text-blue-600" id="twkJawab">0</div>
                            <div class="text-blue-500">Terjawab</div>
                        </div>
                        <div class="bg-green-50 rounded-lg p-2 text-center">
                            <div class="font-bold text-green-600" id="twkBenar">0</div>
                            <div class="text-green-500">Benar</div>
                        </div>
                    </div>
                </div>

                <!-- TIU Card -->
                <div class="bg-white p-5 md:p-6 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex items-center gap-2">
                            <div class="w-8 h-8 bg-gradient-to-r from-green-100 to-green-200 rounded-lg flex items-center justify-center">
                                <i class="fa-solid fa-brain text-green-600"></i>
                            </div>
                            <div>
                                <span class="text-xs font-black text-green-600 uppercase">TIU</span>
                                <p class="text-[10px] font-bold text-slate-400 uppercase">Tes Intelegensi Umum</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="text-[10px] font-bold text-slate-400">Passing Grade</span>
                            <div class="text-xs font-black text-slate-800">80</div>
                        </div>
                    </div>
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-1">
                            <span id="skorTIU" class="text-3xl md:text-4xl font-black text-slate-800 animate-score">0</span>
                            <span id="statusTIU" class="text-[10px] font-bold uppercase tracking-wider px-3 py-1 rounded-full"></span>
                        </div>
                        <div class="text-xs text-slate-500">
                            <span id="tiuInfo">0 dari 35 soal</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="flex justify-between text-xs text-slate-500 mb-1">
                            <span>Progress</span>
                            <span id="tiuProgressText">0%</span>
                        </div>
                        <div class="w-full bg-slate-100 h-2 rounded-full overflow-hidden">
                            <div id="progressTIU" class="h-full bg-gradient-to-r from-green-500 to-green-600 progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-2 text-xs">
                        <div class="bg-green-50 rounded-lg p-2 text-center">
                            <div class="font-bold text-green-600" id="tiuJawab">0</div>
                            <div class="text-green-500">Terjawab</div>
                        </div>
                        <div class="bg-green-50 rounded-lg p-2 text-center">
                            <div class="font-bold text-green-600" id="tiuBenar">0</div>
                            <div class="text-green-500">Benar</div>
                        </div>
                    </div>
                </div>

                <!-- TKP Card -->
                <div class="bg-white p-5 md:p-6 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex items-center gap-2">
                            <div class="w-8 h-8 bg-gradient-to-r from-purple-100 to-purple-200 rounded-lg flex items-center justify-center">
                                <i class="fa-solid fa-users text-purple-600"></i>
                            </div>
                            <div>
                                <span class="text-xs font-black text-purple-600 uppercase">TKP</span>
                                <p class="text-[10px] font-bold text-slate-400 uppercase">Karakteristik Pribadi</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="text-[10px] font-bold text-slate-400">Passing Grade</span>
                            <div class="text-xs font-black text-slate-800">166</div>
                        </div>
                    </div>
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-1">
                            <span id="skorTKP" class="text-3xl md:text-4xl font-black text-slate-800 animate-score">0</span>
                            <span id="statusTKP" class="text-[10px] font-bold uppercase tracking-wider px-3 py-1 rounded-full"></span>
                        </div>
                        <div class="text-xs text-slate-500">
                            <span id="tkpInfo">0 dari 45 soal</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="flex justify-between text-xs text-slate-500 mb-1">
                            <span>Progress</span>
                            <span id="tkpProgressText">0%</span>
                        </div>
                        <div class="w-full bg-slate-100 h-2 rounded-full overflow-hidden">
                            <div id="progressTKP" class="h-full bg-gradient-to-r from-purple-500 to-purple-600 progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-2 text-xs">
                        <div class="bg-purple-50 rounded-lg p-2 text-center">
                            <div class="font-bold text-purple-600" id="tkpJawab">0</div>
                            <div class="text-purple-500">Terjawab</div>
                        </div>
                        <div class="bg-purple-50 rounded-lg p-2 text-center">
                            <div class="font-bold text-purple-600" id="tkpRagu">0</div>
                            <div class="text-purple-500">Ragu-ragu</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="bg-gradient-to-r from-slate-900 to-slate-800 rounded-2xl p-6 mb-8 text-white">
                <h3 class="font-bold text-lg mb-6 flex items-center gap-2">
                    <i class="fa-solid fa-chart-simple"></i>
                    Statistik Cepat
                </h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="bg-white/10 rounded-xl p-4 text-center backdrop-blur-sm">
                        <div class="text-2xl font-black mb-1" id="totalSoal">0</div>
                        <div class="text-sm text-white/80">Total Soal</div>
                    </div>
                    <div class="bg-white/10 rounded-xl p-4 text-center backdrop-blur-sm">
                        <div class="text-2xl font-black mb-1" id="totalTerjawab">0</div>
                        <div class="text-sm text-white/80">Terjawab</div>
                    </div>
                    <div class="bg-white/10 rounded-xl p-4 text-center backdrop-blur-sm">
                        <div class="text-2xl font-black mb-1" id="akurasi">0%</div>
                        <div class="text-sm text-white/80">Akurasi</div>
                    </div>
                    <div class="bg-white/10 rounded-xl p-4 text-center backdrop-blur-sm">
                        <div class="text-2xl font-black mb-1" id="peringkat">-</div>
                        <div class="text-sm text-white/80">Peringkat</div>
                    </div>
                </div>
                <div class="mt-6 pt-6 border-t border-white/20">
                    <div class="flex flex-wrap gap-4 justify-between">
                        <div class="flex items-center gap-2">
                            <i class="fa-solid fa-bookmark text-yellow-400"></i>
                            <span class="text-sm">Soal ditandai: <span id="totalBookmarks" class="font-bold">0</span></span>
                        </div>
                        <div class="flex items-center gap-2">
                            <i class="fa-solid fa-question-circle text-blue-400"></i>
                            <span class="text-sm">Ragu-ragu: <span id="totalRagu" class="font-bold">0</span></span>
                        </div>
                        <div class="flex items-center gap-2">
                            <i class="fa-solid fa-clock text-green-400"></i>
                            <span class="text-sm">Waktu: <span id="totalWaktu" class="font-bold">-</span></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-col md:flex-row gap-4 justify-center items-center mb-12">
                <button onclick="kembaliDashboard()" class="w-full md:w-auto bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-8 py-4 rounded-2xl font-bold text-sm hover:from-blue-700 hover:to-indigo-700 transition-all shadow-xl shadow-blue-100 active:scale-95 flex items-center justify-center gap-2 no-print">
                    <i class="fa-solid fa-house"></i> Kembali ke Dashboard
                </button>
                <button onclick="showShareModal()" class="w-full md:w-auto bg-gradient-to-r from-green-500 to-emerald-600 text-white px-8 py-4 rounded-2xl font-bold text-sm hover:from-green-600 hover:to-emerald-700 transition-all shadow-xl shadow-green-100 active:scale-95 flex items-center justify-center gap-2 no-print">
                    <i class="fa-solid fa-share"></i> Bagikan Hasil
                </button>
                <button onclick="ulangiTryout()" class="w-full md:w-auto bg-gradient-to-r from-yellow-500 to-amber-600 text-white px-8 py-4 rounded-2xl font-bold text-sm hover:from-yellow-600 hover:to-amber-700 transition-all shadow-xl shadow-yellow-100 active:scale-95 flex items-center justify-center gap-2 no-print">
                    <i class="fa-solid fa-rotate"></i> Ulangi Tryout
                </button>
                <button onclick="printResult()" class="w-full md:w-auto bg-white text-slate-600 px-8 py-4 rounded-2xl font-bold text-sm border border-slate-200 hover:bg-slate-50 transition-all active:scale-95 flex items-center justify-center gap-2">
                    <i class="fa-solid fa-print"></i> Cetak Hasil
                </button>
            </div>

            <!-- Recommendations -->
            <div id="recommendationsSection" class="hidden">
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-6 mb-8 border border-blue-100">
                    <h3 class="font-bold text-slate-800 text-lg mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-lightbulb text-yellow-500"></i>
                        Rekomendasi Belajar
                    </h3>
                    <div id="recommendationsContent" class="space-y-3"></div>
                </div>
            </div>

            <!-- Certificate Section -->
            <div id="certificateSection" class="hidden">
                <div class="bg-gradient-to-r from-emerald-50 to-green-50 rounded-2xl p-6 mb-8 border border-emerald-100">
                    <h3 class="font-bold text-slate-800 text-lg mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-award text-emerald-500"></i>
                        Sertifikat Penyelesaian
                    </h3>
                    <div class="flex flex-col md:flex-row items-center justify-between gap-6">
                        <div class="flex-1">
                            <p class="text-slate-600 mb-4">Selamat! Anda telah menyelesaikan simulasi tryout dengan baik. Unduh sertifikat digital sebagai bukti penyelesaian.</p>
                            <button onclick="downloadCertificate()" class="bg-gradient-to-r from-emerald-500 to-green-600 text-white px-6 py-3 rounded-xl font-bold hover:from-emerald-600 hover:to-green-700 transition-all flex items-center gap-2">
                                <i class="fa-solid fa-download"></i> Unduh Sertifikat (PDF)
                            </button>
                        </div>
                        <div class="w-32 h-32 bg-gradient-to-br from-emerald-400 to-green-500 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fa-solid fa-certificate text-white text-5xl"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="mt-12 pt-8 pb-6 border-t border-slate-200 bg-white">
        <div class="container mx-auto px-4 text-center">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4 mb-6">
                <div class="text-center md:text-left">
                    <div class="flex items-center justify-center md:justify-start gap-2 mb-2">
                        <div class="w-6 h-6 bg-blue-600 rounded flex items-center justify-center">
                            <i class="fa-solid fa-graduation-cap text-white text-xs"></i>
                        </div>
                        <span class="font-extrabold text-blue-600">
                            KERJA JADI <span class="text-yellow-500">ASN</span>
                        </span>
                    </div>
                    <p class="text-slate-500 text-xs">Platform Tryout CAT CPNS Premium</p>
                </div>
                <div class="text-center">
                    <div class="flex justify-center gap-4 mb-2">
                        <a href="#" class="text-slate-400 hover:text-blue-600"><i class="fab fa-facebook"></i></a>
                        <a href="#" class="text-slate-400 hover:text-blue-400"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-slate-400 hover:text-pink-600"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="text-slate-400 hover:text-green-600"><i class="fab fa-whatsapp"></i></a>
                    </div>
                    <p class="text-slate-400 text-[10px] font-bold uppercase tracking-widest">
                        &copy; <span id="currentYear"></span> Kerja Jadi ASN. All rights reserved.
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // ========== 1. GLOBAL VARIABLES ==========
        let pinAkses = null;
        let resultData = null;
        let paketNumber = null;
        let paketPin = null;

        // Database PIN sesuai dengan login.html
        const pinDatabase = {
            "paket1": ["7XK9WP", "B4ZM1Q", "9TV2NL", "RS8MX3", "5CR1VT", "KP9MZ4", "G6HD2S", "1VT8NR", "FN2VK5", "2YM4BX", "MR2VT8", "5HG9SL", "XP3KZ7", "2YN5VQ", "8WQ4PZ", "VS7NL2"],
            "paket2": ["9ZW1RF", "4FB6NT", "7XK1WP", "B2MK9P", "LP9QX4", "Y7CR2V", "4FB8NR", "9TW1MZ", "SK3JP7", "1VT5NR", "FN9VK3", "2YM7BX", "SK9JP4", "MR7VT1", "3ZW7RB", "KP1MX9", "G6HD1S"],
            "paket3": ["VS4NL8", "RT9XM2", "B2MK8P", "7XL1WQ", "5HG2SD", "9ZW4RB", "KP8MX3", "FN5VK2", "8WQ4PZ", "2YM9BX", "7KP1RT", "5HG6SD", "9ZW3RF", "RS4ML9", "VN7VK1", "8WQ3PZ", "4FB1NT"]
        };

        // ========== 2. INITIALIZATION ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Hasil page initializing...');
            document.getElementById('currentYear').textContent = new Date().getFullYear();
            loadResultData();
            setupEventListeners();
            console.log('Hasil page initialized');
        });

        // ========== 3. FUNGSI DETEKSI PAKET DARI PIN ==========
        function detectPaketFromPin(pin) {
            for (const paket in pinDatabase) {
                if (pinDatabase[paket].includes(pin)) {
                    return {
                        paketNumber: paket.replace('paket', ''),
                        paketName: paket
                    };
                }
            }
            return { paketNumber: "1", paketName: "paket1" };
        }

        // ========== 4. LOAD RESULT DATA ==========
        function loadResultData() {
            const urlParams = new URLSearchParams(window.location.search);
            pinAkses = urlParams.get('id');

            if (!pinAkses) {
                showErrorState();
                showToast('error', 'PIN Tidak Valid', 'Redirecting to dashboard...');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 3000);
                return;
            }

            // Deteksi paket berdasarkan PIN
            const paketInfo = detectPaketFromPin(pinAkses);
            paketNumber = paketInfo.paketNumber;
            paketPin = pinAkses;

            // Tampilkan informasi paket dan PIN
            document.getElementById('displayPin').textContent = pinAkses;
            document.getElementById('displayPaketPin').textContent = pinAkses;
            document.getElementById('paketNumber').textContent = paketNumber;
            document.getElementById('analysisPin').textContent = pinAkses;
            document.getElementById('analysisPaket').textContent = paketNumber;

            // CARI DATA DARI BERBAGAI SUMBER
            // Karena soalpaket1.html digunakan untuk semua PIN, data bisa disimpan dengan berbagai format
            const possibleKeys = [
                // Format terbaru: berdasarkan paket yang terdeteksi
                `hasil_paket${paketNumber}_${pinAkses}`,
                
                // Format lama: semua data disimpan sebagai paket1 (karena soalpaket1.html)
                `hasil_paket1_${pinAkses}`,
                
                // Format alternatif
                `hasil_${pinAkses}`,
                `hasil_paket_${pinAkses}`,
                `quiz_result_${pinAkses}`,
                `simulasi_hasil_${pinAkses}`,
                
                // Coba semua paket untuk kompatibilitas
                `hasil_paket2_${pinAkses}`,
                `hasil_paket3_${pinAkses}`
            ];

            console.log('Mencari data hasil untuk PIN:', pinAkses, 'Paket:', paketNumber);
            console.log('Kunci yang dicari:', possibleKeys);

            let foundData = null;
            let foundKey = null;
            
            // Coba semua kemungkinan kunci
            for (const key of possibleKeys) {
                const storedData = localStorage.getItem(key);
                if (storedData) {
                    try {
                        foundData = JSON.parse(storedData);
                        foundKey = key;
                        console.log('‚úÖ Data ditemukan dengan kunci:', key);
                        break;
                    } catch (e) {
                        console.error('Error parsing data dari kunci:', key, e);
                    }
                }
            }

            // Jika tidak ditemukan, cari semua kunci yang mengandung PIN
            if (!foundData) {
                console.log('üîç Mencari semua kunci di localStorage yang mengandung PIN...');
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.includes(pinAkses)) {
                        console.log('Kunci ditemukan:', key);
                        try {
                            const data = JSON.parse(localStorage.getItem(key));
                            // Validasi apakah ini data hasil
                            if (data && (data.total !== undefined || data.twk !== undefined)) {
                                foundData = data;
                                foundKey = key;
                                console.log('‚úÖ Data hasil ditemukan di kunci:', key);
                                break;
                            }
                        } catch (e) {
                            console.error('Error parsing data dari:', key, e);
                        }
                    }
                }
            }

            if (!foundData) {
                showErrorState();
                showToast('error', 'Data Hasil Tidak Ditemukan', 
                    `Tidak dapat menemukan data hasil untuk PIN ${pinAkses}. 
                     Pastikan Anda telah menyelesaikan ujian atau coba kembali ke dashboard.`);
                
                // Log semua data untuk debugging
                console.log('=== DEBUG: Semua data di localStorage ===');
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    console.log(key, ':', localStorage.getItem(key));
                }
                return;
            }

            resultData = foundData;
            console.log('Data hasil berhasil dimuat:', resultData);
            
            // Pastikan data memiliki properti paket
            if (!resultData.paket) {
                resultData.paket = paketNumber;
            }

            // Simpan data dengan format standar untuk konsistensi
            const standardKey = `hasil_paket${paketNumber}_${pinAkses}`;
            if (foundKey !== standardKey) {
                localStorage.setItem(standardKey, JSON.stringify(resultData));
                console.log('‚úÖ Data disimpan dengan format standar:', standardKey);
            }

            // Proses dan tampilkan hasil
            processResult();
        }

        // ========== 5. PROCESS RESULT ==========
        function processResult() {
            if (!resultData) return;

            // Show loading state first
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('successState').classList.remove('hidden');

            // Calculate additional stats
            const totalSoal = 110;
            const totalTerjawab = (resultData.twkJawab || 0) + (resultData.tiuJawab || 0) + (resultData.tkpJawab || 0);
            const totalBenar = (resultData.twkBenar || 0) + (resultData.tiuBenar || 0);
            const akurasi = totalTerjawab > 0 ? Math.round((totalBenar / (resultData.twkJawab + resultData.tiuJawab || 1)) * 100) : 0;
            const totalScoreMax = 650;
            const scorePercentage = Math.round((resultData.total / totalScoreMax) * 100);

            // Check passing grade
            const PG = { twk: 65, tiu: 80, tkp: 166 };
            const lulusTWK = resultData.twk >= PG.twk;
            const lulusTIU = resultData.tiu >= PG.tiu;
            const lulusTKP = resultData.tkp >= PG.tkp;
            const semuaLulus = lulusTWK && lulusTIU && lulusTKP;

            // Update UI
            updateScores(resultData, totalSoal, totalTerjawab, akurasi, scorePercentage);
            updatePassingStatus(lulusTWK, lulusTIU, lulusTKP, semuaLulus);
            updateProgressBars(resultData, PG);
            updateRecommendations(lulusTWK, lulusTIU, lulusTKP);

            // Trigger animations
            setTimeout(() => {
                triggerAnimations();
                if (semuaLulus) {
                    createConfetti();
                    showCertificateSection();
                }
            }, 500);

            // Save to progress history
            saveToProgressHistory();

            // Show toast
            if (semuaLulus) {
                showToast('success', 'Selamat!', 'Anda berhasil melewati semua passing grade! üéâ');
            } else {
                showToast('info', 'Hasil Selesai', 'Analisis hasil Anda sudah tersedia');
            }
        }

        function updateScores(data, totalSoal, totalTerjawab, akurasi, scorePercentage) {
            // Animate total score
            animateCounter('totalSkor', 0, data.total, 1500);

            // Update category scores
            document.getElementById('skorTWK').textContent = data.twk;
            document.getElementById('skorTIU').textContent = data.tiu;
            document.getElementById('skorTKP').textContent = data.tkp;

            // Update score percentage
            document.getElementById('scorePercentage').textContent = `${scorePercentage}%`;
            updateScoreRing(scorePercentage);

            // Update info text
            document.getElementById('twkInfo').textContent = `${data.twkJawab || 0} dari 30 soal`;
            document.getElementById('tiuInfo').textContent = `${data.tiuJawab || 0} dari 35 soal`;
            document.getElementById('tkpInfo').textContent = `${data.tkpJawab || 0} dari 45 soal`;

            // Update stats
            document.getElementById('twkJawab').textContent = data.twkJawab || 0;
            document.getElementById('twkBenar').textContent = data.twkBenar || 0;
            document.getElementById('tiuJawab').textContent = data.tiuJawab || 0;
            document.getElementById('tiuBenar').textContent = data.tiuBenar || 0;
            document.getElementById('tkpJawab').textContent = data.tkpJawab || 0;
            document.getElementById('tkpRagu').textContent = data.ragu || 0;

            // Update waktu pengerjaan
            if (data.waktu) {
                document.getElementById('waktuPengerjaan').textContent = `Selesai dalam ${data.waktu}`;
                document.getElementById('totalWaktu').textContent = data.waktu;
            }

            // Update quick stats
            document.getElementById('totalSoal').textContent = totalSoal;
            document.getElementById('totalTerjawab').textContent = totalTerjawab;
            document.getElementById('akurasi').textContent = `${akurasi}%`;
            document.getElementById('totalBookmarks').textContent = data.bookmarks || 0;
            document.getElementById('totalRagu').textContent = data.ragu || 0;

            // Update peringkat (simulated)
            const peringkat = Math.floor(Math.random() * 50) + 1;
            document.getElementById('peringkat').textContent = `#${peringkat}`;
        }

        function updatePassingStatus(lulusTWK, lulusTIU, lulusTKP, semuaLulus) {
            // Update status badges
            updateStatusLabel('statusTWK', lulusTWK, 'TWK');
            updateStatusLabel('statusTIU', lulusTIU, 'TIU');
            updateStatusLabel('statusTKP', lulusTKP, 'TKP');

            // Update main status badge
            const statusBadge = document.getElementById('statusBadge');
            const pesanKelulusan = document.getElementById('pesanKelulusan');

            if (semuaLulus) {
                statusBadge.innerHTML = `<i class="fa-solid fa-check-circle"></i> LULUS PASSING GRADE`;
                statusBadge.className = 'inline-flex items-center gap-2 px-6 py-2 rounded-full font-black text-xs uppercase tracking-[0.2em] mb-4 bg-gradient-to-r from-green-100 to-emerald-100 text-green-700 border border-green-200 animate-pulse-slow';
                pesanKelulusan.innerHTML = `<strong>Selamat!</strong> Anda berhasil melampaui semua ambang batas passing grade. Pertahankan performa ini dengan terus berlatih dan mempelajari materi yang belum dikuasai.`;
            } else {
                statusBadge.innerHTML = `<i class="fa-solid fa-exclamation-triangle"></i> PERLU PERBAIKAN`;
                statusBadge.className = 'inline-flex items-center gap-2 px-6 py-2 rounded-full font-black text-xs uppercase tracking-[0.2em] mb-4 bg-gradient-to-r from-yellow-100 to-amber-100 text-amber-700 border border-amber-200 animate-pulse-slow';
                const belumLulus = [];
                if (!lulusTWK) belumLulus.push('TWK');
                if (!lulusTIU) belumLulus.push('TIU');
                if (!lulusTKP) belumLulus.push('TKP');
                pesanKelulusan.innerHTML = `<strong>Perhatian!</strong> Anda belum mencapai ambang batas di materi <strong>${belumLulus.join(', ')}</strong>. Fokuskan latihan pada materi tersebut dan pelajari pembahasan soal untuk meningkatkan pemahaman.`;
            }
        }

        function updateProgressBars(data, PG) {
            // Calculate progress percentages
            const twkProgress = Math.min((data.twk / PG.twk) * 100, 100);
            const tiuProgress = Math.min((data.tiu / PG.tiu) * 100, 100);
            const tkpProgress = Math.min((data.tkp / PG.tkp) * 100, 100);

            // Update progress bars with animation
            setTimeout(() => {
                document.getElementById('progressTWK').style.width = `${twkProgress}%`;
                document.getElementById('progressTIU').style.width = `${tiuProgress}%`;
                document.getElementById('progressTKP').style.width = `${tkpProgress}%`;

                document.getElementById('twkProgressText').textContent = `${Math.round(twkProgress)}%`;
                document.getElementById('tiuProgressText').textContent = `${Math.round(tiuProgress)}%`;
                document.getElementById('tkpProgressText').textContent = `${Math.round(tkpProgress)}%`;
            }, 1000);
        }

        function updateScoreRing(percentage) {
            const progressRing = document.getElementById('totalScoreRing');
            if (progressRing) {
                const circumference = 2 * Math.PI * 15.9155;
                const dashOffset = circumference - (percentage / 100) * circumference;
                setTimeout(() => {
                    progressRing.setAttribute('stroke-dasharray', `${circumference} ${circumference}`);
                    progressRing.setAttribute('stroke-dashoffset', dashOffset);
                }, 800);
            }
        }

        function updateStatusLabel(elementId, isLulus, kategori) {
            const element = document.getElementById(elementId);
            if (isLulus) {
                element.textContent = `LULUS ${kategori}`;
                element.className = 'text-[10px] font-bold uppercase tracking-wider px-3 py-1 rounded-full bg-green-100 text-green-700';
            } else {
                element.textContent = `GAGAL ${kategori}`;
                element.className = 'text-[10px] font-bold uppercase tracking-wider px-3 py-1 rounded-full bg-red-100 text-red-700';
            }
        }

        // ========== 6. ANIMATIONS ==========
        function animateCounter(elementId, start, end, duration) {
            const element = document.getElementById(elementId);
            const range = end - start;
            const increment = end > start ? 1 : -1;
            const stepTime = Math.abs(Math.floor(duration / range));
            let current = start;
            const timer = setInterval(() => {
                current += increment;
                element.textContent = current;
                if (current === end) clearInterval(timer);
            }, stepTime);
        }

        function triggerAnimations() {
            const scoreElements = document.querySelectorAll('.animate-score');
            scoreElements.forEach(el => {
                el.classList.add('animate-score');
                setTimeout(() => el.classList.remove('animate-score'), 1000);
            });
        }

        function createConfetti() {
            const colors = ['#3b82f6', '#8b5cf6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'];
            const container = document.getElementById('confetti-container');
            for (let i = 0; i < 150; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.position = 'absolute';
                    confetti.style.width = Math.random() * 10 + 5 + 'px';
                    confetti.style.height = Math.random() * 10 + 5 + 'px';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.top = '-20px';
                    confetti.style.borderRadius = '2px';
                    confetti.style.opacity = '0.8';
                    confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                    container.appendChild(confetti);
                    const animation = confetti.animate([
                        { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
                        { transform: `translateY(${window.innerHeight}px) rotate(${Math.random() * 720}deg)`, opacity: 0 }
                    ], {
                        duration: Math.random() * 3000 + 2000,
                        easing: 'cubic-bezier(0.215, 0.610, 0.355, 1)'
                    });
                    animation.onfinish = () => confetti.remove();
                }, i * 20);
            }
        }

        // ========== 7. RECOMMENDATIONS ==========
        function updateRecommendations(lulusTWK, lulusTIU, lulusTKP) {
            const recommendations = [];
            if (!lulusTWK) {
                recommendations.push({
                    title: 'Perkuat Wawasan Kebangsaan',
                    message: 'Fokus pada pemahaman UUD 1945, Pancasila, NKRI, dan sejarah perjuangan bangsa.',
                    icon: 'fa-landmark',
                    color: 'blue'
                });
            }
            if (!lulusTIU) {
                recommendations.push({
                    title: 'Tingkatkan Kemampuan Numerik & Verbal',
                    message: 'Latihan soal hitungan, logika, dan analogi secara rutin untuk meningkatkan kecepatan.',
                    icon: 'fa-brain',
                    color: 'green'
                });
            }
            if (!lulusTKP) {
                recommendations.push({
                    title: 'Kembangkan Karakter Kepribadian',
                    message: 'Pahami nilai-nilai pelayanan publik, integritas, dan semangat gotong royong.',
                    icon: 'fa-users',
                    color: 'purple'
                });
            }
            if (recommendations.length === 0) {
                recommendations.push({
                    title: 'Pertahankan Performa',
                    message: 'Lanjutkan latihan dengan variasi soal yang lebih kompleks untuk persiapan maksimal.',
                    icon: 'fa-trophy',
                    color: 'yellow'
                });
            }
            recommendations.push({
                title: 'Gunakan Fitur Pembahasan',
                message: 'Pelajari pembahasan setiap soal untuk memahami konsep dan cara penyelesaian.',
                icon: 'fa-book-open',
                color: 'indigo'
            });

            const container = document.getElementById('recommendationsContent');
            container.innerHTML = '';
            recommendations.forEach(rec => {
                const colorClasses = {
                    blue: 'bg-blue-50 border-blue-200',
                    green: 'bg-green-50 border-green-200',
                    purple: 'bg-purple-50 border-purple-200',
                    yellow: 'bg-yellow-50 border-yellow-200',
                    indigo: 'bg-indigo-50 border-indigo-200'
                };
                const iconColors = {
                    blue: 'text-blue-600',
                    green: 'text-green-600',
                    purple: 'text-purple-600',
                    yellow: 'text-yellow-600',
                    indigo: 'text-indigo-600'
                };
                const item = `
                    <div class="flex items-start gap-3 p-3 rounded-xl ${colorClasses[rec.color]} border">
                        <div class="w-8 h-8 rounded-lg ${colorClasses[rec.color].split(' ')[0]} flex items-center justify-center">
                            <i class="fa-solid ${rec.icon} ${iconColors[rec.color]}"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-800 text-sm mb-1">${rec.title}</h4>
                            <p class="text-xs text-slate-600">${rec.message}</p>
                        </div>
                    </div>
                `;
                container.innerHTML += item;
            });
            document.getElementById('recommendationsSection').classList.remove('hidden');
        }

        function showCertificateSection() {
            document.getElementById('certificateSection').classList.remove('hidden');
        }

        // ========== 8. ACTION FUNCTIONS ==========
        function kembaliDashboard() {
            // Gunakan paketNumber yang sudah dideteksi dari PIN untuk menentukan dashboard yang sesuai
            const dashboardMap = {
                "1": "dashboardpaket1.html",
                "2": "dashboardpaket2.html", 
                "3": "dashboardpaket3.html"
            };
            
            // Ambil nama file dashboard berdasarkan paketNumber
            const dashboardFile = dashboardMap[paketNumber] || "dashboardpaket1.html";
            
            // Redirect ke dashboard yang sesuai
            window.location.href = `${dashboardFile}?id=${pinAkses}`;
        }

        function ulangiTryout() {
            if (confirm('Apakah Anda yakin ingin mengulang tryout ini? Progress sebelumnya akan dihapus.')) {
                // Hapus semua data yang terkait dengan PIN ini
                const keysToDelete = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.includes(pinAkses)) {
                        keysToDelete.push(key);
                    }
                }
                keysToDelete.forEach(key => {
                    localStorage.removeItem(key);
                    console.log('Data dihapus:', key);
                });
                showToast('success', 'Reset Berhasil', 'Mengarahkan ke halaman soal...');
                setTimeout(() => {
                    window.location.href = `soalpaket1.html?id=${pinAkses}`;
                }, 1500);
            }
        }

        function printResult() {
            window.print();
            showToast('info', 'Mencetak', 'Menyiapkan dokumen untuk dicetak...');
        }

        function downloadCertificate() {
            showToast('info', 'Sertifikat', 'Fitur unduh sertifikat akan segera hadir!');
        }

        // ========== 9. SHARE FUNCTIONS ==========
        function showShareModal() {
            document.getElementById('shareModal').classList.remove('hidden');
        }

        function hideShareModal() {
            document.getElementById('shareModal').classList.add('hidden');
        }

        function shareToWhatsApp() {
            const message = encodeURIComponent(generateShareMessage());
            window.open(`https://api.whatsapp.com/send?text=${message}`, '_blank');
        }

        function shareToFacebook() {
            const message = encodeURIComponent(generateShareMessage());
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}&quote=${message}`, '_blank');
        }

        function shareToTwitter() {
            const message = encodeURIComponent(generateShareMessage());
            window.open(`https://twitter.com/intent/tweet?text=${message}&url=${encodeURIComponent(window.location.href)}`, '_blank');
        }

        function copyResultLink() {
            navigator.clipboard.writeText(window.location.href)
                .then(() => showToast('success', 'Link Disalin', 'Tautan hasil telah disalin ke clipboard'))
                .catch(err => {
                    console.error('Failed to copy:', err);
                    showToast('error', 'Gagal Menyalin', 'Tidak dapat menyalin tautan');
                });
        }

        function shareResult() {
            const message = document.getElementById('shareMessage').value;
            const shareText = `${message}\n\nSkor Total: ${resultData.total}\nTWK: ${resultData.twk} | TIU: ${resultData.tiu} | TKP: ${resultData.tkp}\n\n${window.location.href}`;
            if (navigator.share) {
                navigator.share({
                    title: 'Hasil Simulasi CAT CPNS',
                    text: shareText,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(shareText)
                    .then(() => showToast('success', 'Teks Disalin', 'Hasil telah disalin ke clipboard'))
                    .catch(err => {
                        console.error('Failed to copy:', err);
                        showToast('error', 'Gagal Membagikan', 'Tidak dapat membagikan hasil');
                    });
            }
            hideShareModal();
        }

        function generateShareMessage() {
            const lulusTWK = resultData.twk >= 65;
            const lulusTIU = resultData.tiu >= 80;
            const lulusTKP = resultData.tkp >= 166;
            const semuaLulus = lulusTWK && lulusTIU && lulusTKP;
            let status = semuaLulus ? 'üéâ LULUS SEMUA PASSING GRADE!' : 'üìö PERLU PERBAIKAN';
            return `Saya baru saja menyelesaikan simulasi CAT CPNS!\n\n` +
                   `Skor Total: ${resultData.total}\n` +
                   `TWK: ${resultData.twk} | TIU: ${resultData.tiu} | TKP: ${resultData.tkp}\n` +
                   `Status: ${status}\n` +
                   `Paket: ${paketNumber} | PIN: ${pinAkses}\n\n` +
                   `Coba simulasi ini di: ${window.location.origin}`;
        }

        // ========== 10. ANALYSIS FUNCTIONS ==========
        function showAnalysisModal() {
            const content = document.getElementById('analysisContent');
            const analysisHTML = `
                <div class="space-y-6">
                    <div>
                        <h4 class="font-bold text-slate-800 mb-3">Analisis Performa per Kategori</h4>
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between text-sm text-slate-600 mb-1">
                                    <span>TWK - Wawasan Kebangsaan</span>
                                    <span>${resultData.twk}/65 (${Math.round((resultData.twk/65)*100)}%)</span>
                                </div>
                                <div class="w-full bg-slate-100 h-2 rounded-full overflow-hidden">
                                    <div class="h-full bg-blue-600" style="width: ${Math.min((resultData.twk/65)*100, 100)}%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-sm text-slate-600 mb-1">
                                    <span>TIU - Tes Intelegensi Umum</span>
                                    <span>${resultData.tiu}/80 (${Math.round((resultData.tiu/80)*100)}%)</span>
                                </div>
                                <div class="w-full bg-slate-100 h-2 rounded-full overflow-hidden">
                                    <div class="h-full bg-green-600" style="width: ${Math.min((resultData.tiu/80)*100, 100)}%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-sm text-slate-600 mb-1">
                                    <span>TKP - Karakteristik Pribadi</span>
                                    <span>${resultData.tkp}/166 (${Math.round((resultData.tkp/166)*100)}%)</span>
                                </div>
                                <div class="w-full bg-slate-100 h-2 rounded-full overflow-hidden">
                                    <div class="h-full bg-purple-600" style="width: ${Math.min((resultData.tkp/166)*100, 100)}%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-slate-50 rounded-xl p-4">
                            <h5 class="font-bold text-slate-800 text-sm mb-2">Statistik Umum</h5>
                            <div class="space-y-2">
                                <div class="flex justify-between">
                                    <span class="text-slate-600 text-sm">Total Soal</span>
                                    <span class="font-bold">110</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-slate-600 text-sm">Terjawab</span>
                                    <span class="font-bold">${(resultData.twkJawab||0)+(resultData.tiuJawab||0)+(resultData.tkpJawab||0)}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-slate-600 text-sm">Soal Ragu</span>
                                    <span class="font-bold">${resultData.ragu || 0}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-slate-600 text-sm">Waktu</span>
                                    <span class="font-bold">${resultData.waktu || '-'}</span>
                                </div>
                            </div>
                        </div>
                        <div class="bg-slate-50 rounded-xl p-4">
                            <h5 class="font-bold text-slate-800 text-sm mb-2">Akurasi Jawaban</h5>
                            <div class="space-y-2">
                                <div class="flex justify-between">
                                    <span class="text-slate-600 text-sm">TWK Benar</span>
                                    <span class="font-bold">${resultData.twkBenar || 0}/30</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-slate-600 text-sm">TIU Benar</span>
                                    <span class="font-bold">${resultData.tiuBenar || 0}/35</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-slate-600 text-sm">Akurasi Total</span>
                                    <span class="font-bold">${Math.round(((resultData.twkBenar||0)+(resultData.tiuBenar||0))/((resultData.twkJawab||0)+(resultData.tiuJawab||0)+1)*100)}%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-blue-50 rounded-xl p-4 border border-blue-100">
                        <h5 class="font-bold text-blue-800 text-sm mb-2 flex items-center gap-2">
                            <i class="fa-solid fa-lightbulb"></i> Tips Perbaikan
                        </h5>
                        <ul class="text-sm text-blue-700 space-y-2">
                            <li class="flex items-start gap-2"><i class="fa-solid fa-check mt-1 text-xs"></i><span>Review soal yang dijawab dengan ragu-ragu</span></li>
                            <li class="flex items-start gap-2"><i class="fa-solid fa-check mt-1 text-xs"></i><span>Fokus pada materi dengan skor terendah</span></li>
                            <li class="flex items-start gap-2"><i class="fa-solid fa-check mt-1 text-xs"></i><span>Latihan soal dengan waktu terbatas</span></li>
                            <li class="flex items-start gap-2"><i class="fa-solid fa-check mt-1 text-xs"></i><span>Pelajari pembahasan setiap soal</span></li>
                        </ul>
                    </div>
                </div>
            `;
            content.innerHTML = analysisHTML;
            document.getElementById('analysisModal').classList.remove('hidden');
        }

        function hideAnalysisModal() {
            document.getElementById('analysisModal').classList.add('hidden');
        }

        // ========== 11. PROGRESS HISTORY ==========
        function saveToProgressHistory() {
            if (!pinAkses || !resultData) return;
            const historyKey = `progress_${pinAkses}`;
            let progress = JSON.parse(localStorage.getItem(historyKey)) || {};
            progress[`paket_${paketNumber}`] = true;
            progress[`score_${paketNumber}`] = resultData.total;
            progress[`time_${paketNumber}`] = resultData.waktu || '-';
            progress[`accuracy_${paketNumber}`] = Math.round(((resultData.twkBenar || 0) + (resultData.tiuBenar || 0)) / ((resultData.twkJawab || 0) + (resultData.tiuJawab || 0) + 1) * 100);
            progress[`completed_${paketNumber}`] = new Date().toISOString();
            localStorage.setItem(historyKey, JSON.stringify(progress));
        }

        // ========== 12. UI HELPER FUNCTIONS ==========
        function showErrorState() {
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('errorState').classList.remove('hidden');
        }

        function toggleResultMenu() {
            const menu = document.getElementById('resultMenu');
            menu.classList.toggle('hidden');
        }

        function showToast(type, title, message) {
            const toast = document.getElementById('notification-toast');
            const toastIcon = document.getElementById('toast-icon');
            const toastTitle = document.getElementById('toast-title');
            const toastMessage = document.getElementById('toast-message');
            let iconClass, bgColor;
            switch (type) {
                case 'success':
                    iconClass = 'fa-solid fa-circle-check text-green-500';
                    bgColor = 'bg-green-50 border-green-200';
                    break;
                case 'error':
                    iconClass = 'fa-solid fa-circle-xmark text-red-500';
                    bgColor = 'bg-red-50 border-red-200';
                    break;
                default:
                    iconClass = 'fa-solid fa-circle-info text-blue-500';
                    bgColor = 'bg-blue-50 border-blue-200';
            }
            toastIcon.className = iconClass;
            toastTitle.textContent = title;
            toastMessage.textContent = message;
            toast.querySelector('div').className = `bg-white rounded-xl shadow-lg border p-4 max-w-sm animate-fadeIn ${bgColor}`;
            toast.classList.remove('hidden');
            setTimeout(hideToast, 5000);
        }

        function hideToast() {
            document.getElementById('notification-toast').classList.add('hidden');
        }

        // ========== 13. EVENT LISTENERS SETUP ==========
        function setupEventListeners() {
            document.addEventListener('click', (event) => {
                const resultMenu = document.getElementById('resultMenu');
                const resultButton = document.querySelector('[onclick="toggleResultMenu()"]');
                if (resultMenu && !resultMenu.contains(event.target) && resultButton && !resultButton.contains(event.target)) {
                    resultMenu.classList.add('hidden');
                }
                const modals = ['shareModal', 'analysisModal'];
                modals.forEach(modalId => {
                    const modal = document.getElementById(modalId);
                    const modalContent = modal?.querySelector('div > div');
                    if (modal && !modal.classList.contains('hidden') && modalContent && !modalContent.contains(event.target)) {
                        modal.classList.add('hidden');
                    }
                });
            });
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    if (!document.getElementById('shareModal').classList.contains('hidden')) hideShareModal();
                    if (!document.getElementById('analysisModal').classList.contains('hidden')) hideAnalysisModal();
                }
                if (e.ctrlKey && e.key === 'p') {
                    e.preventDefault();
                    printResult();
                }
            });
        }
    </script>
</body>
</html>
