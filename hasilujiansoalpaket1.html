<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hasil Ujian - Paket 1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #1a1a2e;
            color: #ffffff;
        }

        .card {
            background: linear-gradient(135deg, #16213e 0%, #0f3460 100%);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .premium-badge {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            font-weight: 700;
        }

        .pin-display {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            letter-spacing: 3px;
        }

        .score-circle {
            width: 220px;
            height: 220px;
            border-radius: 50%;
            background: linear-gradient(135deg, #16213e 0%, #0f3460 100%);
            border: 8px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .score-inner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-5px);
        }

        .progress-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 1s ease;
        }

        .twk-progress { background: linear-gradient(90deg, #3b82f6 0%, #1d4ed8 100%); }
        .tiu-progress { background: linear-gradient(90deg, #10b981 0%, #059669 100%); }
        .tkp-progress { background: linear-gradient(90deg, #8b5cf6 0%, #7c3aed 100%); }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .section-title {
            position: relative;
            padding-left: 15px;
        }

        .section-title::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 5px;
            height: 20px;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            border-radius: 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border: none;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .icon-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Main Container -->
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <header class="mb-10 fade-in">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-8">
                <div class="flex items-center gap-4">
                    <div class="icon-circle bg-gradient-to-r from-blue-500 to-indigo-600">
                        <i class="fa-solid fa-crown"></i>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold text-white mb-1">KERJA JADI ASN</h1>
                        <div class="flex items-center gap-3">
                            <div class="premium-badge px-4 py-1 rounded-full text-sm">
                                PAKET PREMIUM 1
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="status-indicator"></span>
                                <span id="statusSesi" class="text-sm text-gray-300">Memuat status...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Time and Date Display -->
                <div class="text-right">
                    <div class="text-sm text-gray-400 mb-1">HASIL UJIAN CAT CPNS</div>
                    <div class="text-lg font-bold text-white mb-1" id="tanggalUjian">Memuat tanggal...</div>
                    <div class="text-sm text-gray-300">Paket Soal 1</div>
                </div>
            </div>

            <!-- PIN Display -->
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-8">
                <div class="flex-1">
                    <div class="text-sm text-gray-400 mb-2 uppercase tracking-wider">PIN PESERTA</div>
                    <div id="pinDisplay" class="pin-display px-6 py-4 rounded-xl text-2xl font-bold text-center md:text-left tracking-wider">
                        7XK9WP
                    </div>
                </div>

                <div class="flex flex-col sm:flex-row gap-3">
                    <button id="btnDashboard" class="btn-secondary px-6 py-3 rounded-xl font-semibold flex items-center justify-center gap-2">
                        <i class="fa-solid fa-house"></i>
                        <span>Dashboard</span>
                    </button>
                    <button onclick="cetakHasil()" class="btn-primary px-6 py-3 rounded-xl font-semibold flex items-center justify-center gap-2">
                        <i class="fa-solid fa-print"></i>
                        <span>Cetak Hasil</span>
                    </button>
                </div>
            </div>

            <!-- Motto -->
            <div class="text-center mb-8">
                <h2 class="text-2xl font-bold text-white mb-3">Siap Maksimalkan Persiapan ASN Anda!</h2>
                <p class="text-gray-300 max-w-2xl mx-auto">
                    Gunakan 10 kuota tryout premium dengan strategi. Analisis hasil, tingkatkan akurasi, dan raih skor terbaik!
                </p>
            </div>
        </header>

        <!-- Main Result Section -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-10">
            <!-- Left Column: Score Circle -->
            <div class="lg:col-span-1 flex justify-center">
                <div class="score-circle fade-in">
                    <div class="score-inner">
                        <div id="totalScore" class="text-6xl font-black text-white mb-2">0</div>
                        <div class="text-gray-400 font-medium mb-1">DARI 500</div>
                        <div id="resultEmoji" class="text-3xl mb-3"></div>
                        <div id="resultMessage" class="text-sm text-gray-300 max-w-xs">Memuat hasil ujian...</div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Stats Grid -->
            <div class="lg:col-span-2">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="stat-card p-6 fade-in">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <div class="text-4xl font-bold text-blue-400" id="skorTWK">0</div>
                                <div class="text-sm font-semibold text-gray-300 uppercase mt-1">TWK</div>
                                <div class="text-xs text-gray-400">Wawasan Kebangsaan</div>
                            </div>
                            <div class="icon-circle bg-blue-500/20 text-blue-400">
                                <i class="fa-solid fa-landmark"></i>
                            </div>
                        </div>
                        <div class="progress-bar">
                            <div id="progressTWK" class="progress-fill twk-progress" style="width: 0%"></div>
                        </div>
                        <div class="text-xs text-gray-400 mt-2 text-right" id="twkDetail">0/150 poin</div>
                    </div>

                    <div class="stat-card p-6 fade-in" style="animation-delay: 0.1s">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <div class="text-4xl font-bold text-green-400" id="skorTIU">0</div>
                                <div class="text-sm font-semibold text-gray-300 uppercase mt-1">TIU</div>
                                <div class="text-xs text-gray-400">Tes Intelegensi Umum</div>
                            </div>
                            <div class="icon-circle bg-green-500/20 text-green-400">
                                <i class="fa-solid fa-brain"></i>
                            </div>
                        </div>
                        <div class="progress-bar">
                            <div id="progressTIU" class="progress-fill tiu-progress" style="width: 0%"></div>
                        </div>
                        <div class="text-xs text-gray-400 mt-2 text-right" id="tiuDetail">0/175 poin</div>
                    </div>

                    <div class="stat-card p-6 fade-in" style="animation-delay: 0.2s">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <div class="text-4xl font-bold text-purple-400" id="skorTKP">0</div>
                                <div class="text-sm font-semibold text-gray-300 uppercase mt-1">TKP</div>
                                <div class="text-xs text-gray-400">Karakteristik Pribadi</div>
                            </div>
                            <div class="icon-circle bg-purple-500/20 text-purple-400">
                                <i class="fa-solid fa-user-check"></i>
                            </div>
                        </div>
                        <div class="progress-bar">
                            <div id="progressTKP" class="progress-fill tkp-progress" style="width: 0%"></div>
                        </div>
                        <div class="text-xs text-gray-400 mt-2 text-right" id="tkpDetail">0/166 poin</div>
                    </div>
                </div>

                <!-- Additional Stats -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
                    <div class="stat-card p-5">
                        <div class="flex items-center gap-4">
                            <div class="icon-circle bg-amber-500/20 text-amber-400">
                                <i class="fa-solid fa-clock"></i>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-white" id="waktuDigunakan">0m</div>
                                <div class="text-sm text-gray-300">Waktu Digunakan</div>
                                <div class="text-xs text-gray-400" id="waktuDetail">Memuat...</div>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card p-5">
                        <div class="flex items-center gap-4">
                            <div class="icon-circle bg-red-500/20 text-red-400">
                                <i class="fa-solid fa-question-circle"></i>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-white" id="raguCount">0</div>
                                <div class="text-sm text-gray-300">Soal Ragu</div>
                                <div class="text-xs text-gray-400">Ditandai ragu-ragu</div>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card p-5">
                        <div class="flex items-center gap-4">
                            <div class="icon-circle bg-cyan-500/20 text-cyan-400">
                                <i class="fa-solid fa-bookmark"></i>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-white" id="bookmarkCount">0</div>
                                <div class="text-sm text-gray-300">Bookmark</div>
                                <div class="text-xs text-gray-400">Soal ditandai</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Analysis -->
        <div class="card p-8 mb-10 fade-in" style="animation-delay: 0.3s">
            <h3 class="section-title text-xl font-bold text-white mb-6">Analisis Detail Performa</h3>
            
            <div class="space-y-6">
                <!-- TWK Analysis -->
                <div>
                    <div class="flex justify-between items-center mb-3">
                        <div class="flex items-center gap-3">
                            <div class="w-3 h-3 rounded-full bg-blue-500"></div>
                            <span class="font-semibold text-white">TWK - Wawasan Kebangsaan</span>
                        </div>
                        <span class="text-sm font-medium text-gray-300">
                            <span id="twkBenar">0</span>/30 Benar ‚Ä¢ 
                            <span id="twkTerjawab">0</span>/30 Terjawab
                        </span>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="flex-1 progress-bar">
                            <div id="twkProgress" class="progress-fill twk-progress" style="width: 0%"></div>
                        </div>
                        <span id="twkPersen" class="text-sm font-bold text-white min-w-12 text-right">0%</span>
                    </div>
                    <div class="text-xs text-gray-400 mt-2" id="akurasiTWK">Akurasi: 0%</div>
                </div>

                <!-- TIU Analysis -->
                <div>
                    <div class="flex justify-between items-center mb-3">
                        <div class="flex items-center gap-3">
                            <div class="w-3 h-3 rounded-full bg-green-500"></div>
                            <span class="font-semibold text-white">TIU - Tes Intelegensi Umum</span>
                        </div>
                        <span class="text-sm font-medium text-gray-300">
                            <span id="tiuBenar">0</span>/35 Benar ‚Ä¢ 
                            <span id="tiuTerjawab">0</span>/35 Terjawab
                        </span>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="flex-1 progress-bar">
                            <div id="tiuProgress" class="progress-fill tiu-progress" style="width: 0%"></div>
                        </div>
                        <span id="tiuPersen" class="text-sm font-bold text-white min-w-12 text-right">0%</span>
                    </div>
                    <div class="text-xs text-gray-400 mt-2" id="akurasiTIU">Akurasi: 0%</div>
                </div>

                <!-- TKP Analysis -->
                <div>
                    <div class="flex justify-between items-center mb-3">
                        <div class="flex items-center gap-3">
                            <div class="w-3 h-3 rounded-full bg-purple-500"></div>
                            <span class="font-semibold text-white">TKP - Karakteristik Pribadi</span>
                        </div>
                        <span class="text-sm font-medium text-gray-300">
                            Skor: <span id="tkpSkorDetail">0</span>/166 ‚Ä¢ 
                            <span id="tkpTerjawab">0</span>/45 Terjawab
                        </span>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="flex-1 progress-bar">
                            <div id="tkpProgress" class="progress-fill tkp-progress" style="width: 0%"></div>
                        </div>
                        <span id="tkpPersen" class="text-sm font-bold text-white min-w-12 text-right">0%</span>
                    </div>
                </div>
            </div>

            <!-- Summary Stats -->
            <div class="mt-8 pt-8 border-t border-gray-800">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="text-center p-4 bg-blue-500/10 rounded-xl">
                        <div class="text-3xl font-bold text-blue-400" id="totalAkurasiTWK">0%</div>
                        <div class="text-sm text-gray-300 mt-1">Akurasi TWK</div>
                    </div>
                    <div class="text-center p-4 bg-green-500/10 rounded-xl">
                        <div class="text-3xl font-bold text-green-400" id="totalAkurasiTIU">0%</div>
                        <div class="text-sm text-gray-300 mt-1">Akurasi TIU</div>
                    </div>
                    <div class="text-center p-4 bg-purple-500/10 rounded-xl">
                        <div class="text-3xl font-bold text-white" id="totalAkurasi">0%</div>
                        <div class="text-sm text-gray-300 mt-1">Akurasi Total</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Actions & Footer -->
        <div class="fade-in" style="animation-delay: 0.4s">
            <!-- Action Buttons -->
            <div class="flex flex-col sm:flex-row gap-4 mb-8">
                <button onclick="lihatPembahasan()" class="btn-secondary flex-1 py-4 rounded-xl font-semibold flex items-center justify-center gap-3">
                    <div class="icon-circle bg-gray-800">
                        <i class="fa-solid fa-file-alt"></i>
                    </div>
                    <div class="text-left">
                        <div class="text-lg font-bold">Lihat Pembahasan</div>
                        <div class="text-sm text-gray-400">Review jawaban dan penjelasan</div>
                    </div>
                </button>

                <button onclick="ulangiUjian()" class="btn-primary flex-1 py-4 rounded-xl font-semibold flex items-center justify-center gap-3">
                    <div class="icon-circle bg-green-600">
                        <i class="fa-solid fa-redo"></i>
                    </div>
                    <div class="text-left">
                        <div class="text-lg font-bold">Ulangi Ujian</div>
                        <div class="text-sm text-white/80">Coba lagi dengan soal yang sama</div>
                    </div>
                </button>

                <button onclick="hubungiKami()" class="btn-secondary flex-1 py-4 rounded-xl font-semibold flex items-center justify-center gap-3">
                    <div class="icon-circle bg-green-600">
                        <i class="fa-brands fa-whatsapp"></i>
                    </div>
                    <div class="text-left">
                        <div class="text-lg font-bold">Hubungi Kami</div>
                        <div class="text-sm text-gray-400">Tanya langsung via WhatsApp</div>
                    </div>
                </button>
            </div>

            <!-- Footer Info -->
            <div class="card p-6">
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-6">
                    <div>
                        <div class="text-sm text-gray-400 mb-2">ID PESERTA</div>
                        <div class="pin-display px-4 py-2 rounded-lg text-lg font-bold inline-block">
                            7XK9WP
                        </div>
                        <div class="mt-4">
                            <div class="flex items-center gap-2 text-sm text-gray-400">
                                <i class="fa-solid fa-check-circle text-green-500"></i>
                                <span>Hasil disimpan secara otomatis</span>
                            </div>
                            <div class="flex items-center gap-2 text-sm text-gray-400 mt-1">
                                <i class="fa-solid fa-clock text-blue-500"></i>
                                <span>Selesai: <span id="waktuSelesai" class="font-medium text-white">Memuat...</span></span>
                            </div>
                        </div>
                    </div>

                    <div class="text-center md:text-right">
                        <div class="text-4xl font-bold text-amber-500 mb-2">10</div>
                        <div class="text-sm text-gray-300">Kuota Tryout Premium</div>
                        <div class="text-xs text-gray-400">Sisa 9 kuota</div>
                    </div>
                </div>

                <div class="mt-6 pt-6 border-t border-gray-800 text-center">
                    <p class="text-sm text-gray-400">
                        &copy; 2024 KERJA JADI ASN. Semua hak dilindungi undang-undang.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal for Retry -->
    <div id="modalUlangi" class="hidden fixed inset-0 z-50 bg-black bg-opacity-70 flex items-center justify-center p-4">
        <div class="card p-8 max-w-md w-full fade-in">
            <h3 class="text-2xl font-bold text-white mb-4">Ulangi Ujian Paket 1</h3>
            <p class="text-gray-300 mb-6">Apakah Anda yakin ingin mengulang ujian ini? Hasil sebelumnya akan tetap tersimpan, tetapi progress baru akan dimulai dari awal.</p>
            <div class="flex gap-4">
                <button onclick="tutupModal()" class="btn-secondary flex-1 py-3 rounded-xl font-semibold">
                    Batal
                </button>
                <button onclick="konfirmasiUlangi()" class="btn-primary flex-1 py-3 rounded-xl font-semibold">
                    Ya, Mulai Ulang
                </button>
            </div>
        </div>
    </div>

    <script>
        // ====================== DATA MAPPING ======================
        const paketMapping = {
            "paket1": ["7XK9WP", "B4ZM1Q", "9TV2NL", "RS8MX3", "5CR1VT", "KP9MZ4", "G6HD2S", "1VT8NR", "FN2VK5", "2YM4BX", "MR2VT8", "5HG9SL", "XP3KZ7", "2YN5VQ", "8WQ4PZ", "VS7NL2"],
            "paket2": ["9ZW1RF", "4FB6NT", "7XK1WP", "B2MK9P", "LP9QX4", "Y7CR2V", "4FB8NR", "9TW1MZ", "SK3JP7", "1VT5NR", "FN9VK3", "2YM7BX", "SK9JP4", "MR7VT1", "3ZW7RB", "KP1MX9", "G6HD1S"],
            "paket3": ["VS4NL8", "RT9XM2", "B2MK8P", "7XL1WQ", "5HG2SD", "9ZW4RB", "KP8MX3", "FN5VK2", "8WQ4PZ", "2YM9BX", "7KP1RT", "5HG6SD", "9ZW3RF", "RS4ML9", "VN7VK1", "8WQ3PZ", "4FB1NT"]
        };

        // ====================== GLOBAL VARIABLES ======================
        let hasilData = null;
        let userPIN = null;
        let userPaket = null;

        // ====================== INITIALIZATION ======================
        document.addEventListener('DOMContentLoaded', function() {
            // Get PIN from URL
            const urlParams = new URLSearchParams(window.location.search);
            userPIN = urlParams.get('id');

            if (!userPIN) {
                showError('PIN tidak ditemukan', 'Redirecting ke dashboard...');
                setTimeout(() => {
                    window.location.href = 'dashboardpaket1.html';
                }, 2000);
                return;
            }

            // Determine user's paket based on PIN
            userPaket = determinePaket(userPIN);

            if (!userPaket) {
                showError('PIN tidak valid', 'PIN tidak terdaftar di paket manapun');
                return;
            }

            // Display PIN
            document.getElementById('pinDisplay').textContent = userPIN;
            
            // Update dashboard button
            const dashboardBtn = document.getElementById('btnDashboard');
            dashboardBtn.onclick = function() {
                window.location.href = `dashboard${userPaket}.html?id=${userPIN}`;
            };

            // Update status session
            updateSessionStatus();

            // Load result data
            loadResultData();
        });

        // ====================== HELPER FUNCTIONS ======================
        function determinePaket(pin) {
            for (const [paket, pins] of Object.entries(paketMapping)) {
                if (pins.includes(pin)) {
                    return paket;
                }
            }
            return null;
        }

        function updateSessionStatus() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('id-ID', { 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('statusSesi').textContent = timeString;
        }

        function loadResultData() {
            const resultKey = `hasil_paket1_${userPIN}`;
            const savedResult = localStorage.getItem(resultKey);

            if (!savedResult) {
                showError('Hasil ujian tidak ditemukan', 'Anda belum mengerjakan paket soal 1.');
                return;
            }

            hasilData = JSON.parse(savedResult);
            displayResult();
        }

        function displayResult() {
            if (!hasilData) return;

            // Format dates
            const selesaiDate = new Date(hasilData.selesai);
            const dateOptions = { 
                weekday: 'long',
                year: 'numeric', 
                month: 'long', 
                day: 'numeric'
            };
            const timeOptions = { 
                hour: '2-digit', 
                minute: '2-digit',
                timeZoneName: 'short'
            };

            document.getElementById('tanggalUjian').textContent = 
                selesaiDate.toLocaleDateString('id-ID', dateOptions) + 
                ' ‚Ä¢ ' + 
                selesaiDate.toLocaleTimeString('id-ID', timeOptions);

            document.getElementById('waktuSelesai').textContent = selesaiDate.toLocaleTimeString('id-ID', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });

            // Display scores
            document.getElementById('skorTWK').textContent = hasilData.twk;
            document.getElementById('skorTIU').textContent = hasilData.tiu;
            document.getElementById('skorTKP').textContent = hasilData.tkp;
            document.getElementById('totalScore').textContent = hasilData.total;

            // Update detail text
            document.getElementById('twkDetail').textContent = `${hasilData.twk}/150 poin`;
            document.getElementById('tiuDetail').textContent = `${hasilData.tiu}/175 poin`;
            document.getElementById('tkpDetail').textContent = `${hasilData.tkp}/166 poin`;

            // Calculate percentages for progress bars
            const twkPercent = Math.round((hasilData.twk / 150) * 100);
            const tiuPercent = Math.round((hasilData.tiu / 175) * 100);
            const tkpPercent = Math.round((hasilData.tkp / 166) * 100);
            const totalPercent = Math.round((hasilData.total / 500) * 100);

            // Animate progress bars
            setTimeout(() => {
                document.getElementById('progressTWK').style.width = `${twkPercent}%`;
                document.getElementById('progressTIU').style.width = `${tiuPercent}%`;
                document.getElementById('progressTKP').style.width = `${tkpPercent}%`;
            }, 300);

            // Display answered counts
            document.getElementById('twkTerjawab').textContent = `${hasilData.twkJawab}/30`;
            document.getElementById('tiuTerjawab').textContent = `${hasilData.tiuJawab}/35`;
            document.getElementById('tkpTerjawab').textContent = `${hasilData.tkpJawab}/45`;

            // Animate category progress bars
            const twkJawabPercent = Math.round((hasilData.twkJawab / 30) * 100);
            const tiuJawabPercent = Math.round((hasilData.tiuJawab / 35) * 100);
            const tkpJawabPercent = Math.round((hasilData.tkpJawab / 45) * 100);

            setTimeout(() => {
                document.getElementById('twkProgress').style.width = `${twkJawabPercent}%`;
                document.getElementById('tiuProgress').style.width = `${tiuJawabPercent}%`;
                document.getElementById('tkpProgress').style.width = `${tkpJawabPercent}%`;
            }, 700);

            // Display percentages
            document.getElementById('twkPersen').textContent = `${twkJawabPercent}%`;
            document.getElementById('tiuPersen').textContent = `${tiuJawabPercent}%`;
            document.getElementById('tkpPersen').textContent = `${tkpJawabPercent}%`;

            // Display correct counts
            document.getElementById('twkBenar').textContent = hasilData.twkBenar || 0;
            document.getElementById('tiuBenar').textContent = hasilData.tiuBenar || 0;
            document.getElementById('tkpSkorDetail').textContent = hasilData.tkp;

            // Calculate accuracy
            const twkAccuracy = hasilData.twkJawab > 0 ? Math.round((hasilData.twkBenar / hasilData.twkJawab) * 100) : 0;
            const tiuAccuracy = hasilData.tiuJawab > 0 ? Math.round((hasilData.tiuBenar / hasilData.tiuJawab) * 100) : 0;
            const totalAccuracy = (hasilData.twkJawab + hasilData.tiuJawab) > 0 ? 
                Math.round(((hasilData.twkBenar + hasilData.tiuBenar) / (hasilData.twkJawab + hasilData.tiuJawab)) * 100) : 0;

            setTimeout(() => {
                document.getElementById('akurasiTWK').textContent = `Akurasi: ${twkAccuracy}%`;
                document.getElementById('akurasiTIU').textContent = `Akurasi: ${tiuAccuracy}%`;
                document.getElementById('totalAkurasiTWK').textContent = `${twkAccuracy}%`;
                document.getElementById('totalAkurasiTIU').textContent = `${tiuAccuracy}%`;
                document.getElementById('totalAkurasi').textContent = `${totalAccuracy}%`;
            }, 900);

            // Display time used
            document.getElementById('waktuDigunakan').textContent = hasilData.waktu.split('m')[0] + 'm';
            document.getElementById('waktuDetail').textContent = hasilData.waktu;

            // Display additional info
            document.getElementById('raguCount').textContent = hasilData.ragu || 0;
            document.getElementById('bookmarkCount').textContent = hasilData.bookmarks || 0;

            // Display result message and emoji based on score
            displayResultMessage(hasilData.total);
        }

        function displayResultMessage(totalScore) {
            const resultMessage = document.getElementById('resultMessage');
            const resultEmoji = document.getElementById('resultEmoji');

            let message = '';
            let emoji = '';

            if (totalScore >= 400) {
                message = 'Luar biasa! Skor Anda sangat tinggi.';
                emoji = 'üèÜ';
            } else if (totalScore >= 350) {
                message = 'Bagus sekali! Performa Anda sangat baik.';
                emoji = 'üéØ';
            } else if (totalScore >= 300) {
                message = 'Hasil yang baik! Anda sudah menguasai materi.';
                emoji = '‚≠ê';
            } else if (totalScore >= 250) {
                message = 'Cukup baik. Perlu sedikit peningkatan.';
                emoji = 'üëç';
            } else if (totalScore >= 200) {
                message = 'Perlu lebih banyak latihan.';
                emoji = 'üí™';
            } else {
                message = 'Pelajari kembali materinya dan coba lagi.';
                emoji = 'üìö';
            }

            resultMessage.textContent = message;
            resultEmoji.textContent = emoji;
        }

        // ====================== ACTION FUNCTIONS ======================
        function cetakHasil() {
            window.print();
        }

        function lihatPembahasan() {
            showToast('info', 'Fitur Pembahasan', 'Fitur pembahasan soal akan segera hadir!');
        }

        function ulangiUjian() {
            document.getElementById('modalUlangi').classList.remove('hidden');
        }

        function tutupModal() {
            document.getElementById('modalUlangi').classList.add('hidden');
        }

        function konfirmasiUlangi() {
            const progressKey = `progress_paket1_${userPIN}`;
            localStorage.removeItem(progressKey);
            window.location.href = `soalpaket1.html?id=${userPIN}`;
        }

        function hubungiKami() {
            const phoneNumber = "6281234567890";
            const message = `Halo, saya ingin bertanya tentang hasil ujian CAT CPNS Paket 1 dengan PIN: ${userPIN}`;
            const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        // ====================== UI FUNCTIONS ======================
        function showError(title, message) {
            showToast('error', title, message);
            document.getElementById('totalScore').textContent = '--';
            document.getElementById('resultMessage').textContent = message;
            document.getElementById('resultEmoji').textContent = '‚ùå';
        }

        function showToast(type, title, message) {
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 z-50 max-w-sm`;

            let bgColor = 'bg-gray-800';
            let borderColor = 'border-gray-700';
            let icon = 'fa-circle-info';
            let iconColor = 'text-blue-400';

            switch (type) {
                case 'success':
                    bgColor = 'bg-green-900/50';
                    borderColor = 'border-green-700';
                    icon = 'fa-circle-check';
                    iconColor = 'text-green-400';
                    break;
                case 'error':
                    bgColor = 'bg-red-900/50';
                    borderColor = 'border-red-700';
                    icon = 'fa-circle-xmark';
                    iconColor = 'text-red-400';
                    break;
                case 'warning':
                    bgColor = 'bg-yellow-900/50';
                    borderColor = 'border-yellow-700';
                    icon = 'fa-triangle-exclamation';
                    iconColor = 'text-yellow-400';
                    break;
            }

            toast.innerHTML = `
                <div class="${bgColor} border ${borderColor} rounded-xl shadow-lg p-4">
                    <div class="flex items-start gap-3">
                        <i class="fa-solid ${icon} ${iconColor} mt-0.5"></i>
                        <div class="flex-1">
                            <h4 class="font-semibold text-white">${title}</h4>
                            <p class="text-sm text-gray-300 mt-1">${message}</p>
                        </div>
                        <button onclick="this.parentElement.parentElement.remove()" class="text-gray-400 hover:text-white">
                            <i class="fa-solid fa-times"></i>
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(toast);

            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 4000);
        }

        // Update session status every second
        setInterval(updateSessionStatus, 1000);
    </script>
</body>
</html>