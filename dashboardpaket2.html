<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Paket 2 Premium - Kerja Jadi ASN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#8B5CF6">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #f8fafc 0%, #f3f4f6 100%);
        }

        /* Mobile First Design */
        @media (max-width: 640px) {
            .container {
                padding-left: 0.75rem;
                padding-right: 0.75rem;
            }
            
            .mobile-full {
                width: 100% !important;
            }
            
            .mobile-stack {
                flex-direction: column !important;
            }
            
            .mobile-text-center {
                text-align: center !important;
            }
            
            .mobile-hide {
                display: none !important;
            }
            
            .mobile-show {
                display: block !important;
            }
            
            .mobile-padding {
                padding: 1rem !important;
            }
            
            .mobile-margin {
                margin: 0.5rem !important;
            }
            
            .mobile-card {
                padding: 1rem !important;
                margin-bottom: 0.75rem !important;
            }
        }

        /* Tablet Responsive */
        @media (min-width: 641px) and (max-width: 1024px) {
            .tablet-full {
                width: 100% !important;
            }
            
            .tablet-half {
                width: 50% !important;
            }
            
            .tablet-grid-2 {
                grid-template-columns: repeat(2, 1fr) !important;
            }
        }

        /* Desktop Optimized */
        @media (min-width: 1025px) {
            .desktop-sidebar {
                position: sticky;
                top: 5rem;
                height: fit-content;
                max-height: calc(100vh - 6rem);
                overflow-y: auto;
            }
            
            .desktop-main {
                padding-right: 1rem;
            }
        }

        /* Touch Friendly Elements */
        .touch-button {
            min-height: 44px;
            min-width: 44px;
        }
        
        .touch-link {
            padding: 12px 16px;
            display: block;
        }

        /* Loading Animation */
        .loading-skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Custom Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .animate-fadeIn {
            animation: fadeIn 0.5s ease-out;
        }

        .animate-slideInRight {
            animation: slideInRight 0.3s ease-out;
        }

        /* Card Hover Effects - Desktop only */
        @media (hover: hover) and (pointer: fine) {
            .card-hover {
                transition: all 0.3s ease;
                border: 1px solid #e2e8f0;
            }

            .card-hover:hover {
                transform: translateY(-4px);
                box-shadow: 0 20px 40px -15px rgba(139, 92, 246, 0.15);
                border-color: #a78bfa;
            }
        }

        /* Mobile touch feedback */
        .touch-feedback:active {
            transform: scale(0.98);
            transition: transform 0.1s;
        }

        /* Status Badges */
        .status-badge {
            font-size: 0.65rem;
            padding: 0.35rem 0.75rem;
            border-radius: 9999px;
            font-weight: 800;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            white-space: nowrap;
        }

        @media (max-width: 640px) {
            .status-badge {
                font-size: 0.6rem;
                padding: 0.25rem 0.5rem;
            }
        }

        .status-premium {
            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
            color: white;
        }

        .status-completed {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .status-pending {
            background-color: #f59e0b;
            color: white;
        }

        /* Premium Gradient */
        .premium-gradient {
            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 25%, #6D28D9 50%, #5B21B6 75%, #4C1D95 100%);
            background-size: 200% 200%;
            animation: gradient 5s ease infinite;
        }

        @keyframes gradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        /* Mobile Menu */
        .mobile-menu {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e2e8f0;
            z-index: 40;
            padding: 0.5rem;
            display: none;
        }

        @media (max-width: 768px) {
            .mobile-menu {
                display: flex;
                justify-content: space-around;
            }
            
            body {
                padding-bottom: 70px; /* Space for mobile menu */
            }
        }

        /* Mobile Bottom Sheet */
        .bottom-sheet {
            position: fixed;
            bottom: -100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 20px 20px 0 0;
            z-index: 50;
            transition: bottom 0.3s ease;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.1);
        }

        .bottom-sheet.active {
            bottom: 0;
        }

        .bottom-sheet-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 49;
            display: none;
        }

        .bottom-sheet-backdrop.active {
            display: block;
        }

        /* Custom Scrollbar - Desktop only */
        @media (min-width: 1024px) {
            ::-webkit-scrollbar {
                width: 8px;
            }

            ::-webkit-scrollbar-track {
                background: #f1f5f9;
                border-radius: 4px;
            }

            ::-webkit-scrollbar-thumb {
                background: #cbd5e1;
                border-radius: 4px;
            }

            ::-webkit-scrollbar-thumb:hover {
                background: #94a3b8;
            }
        }

        /* Print Styles */
        @media print {
            .no-print {
                display: none !important;
            }

            body {
                background: white !important;
                color: black !important;
                padding: 0 !important;
            }
        }

        /* Performance Optimizations */
        .will-change-transform {
            will-change: transform;
        }
        
        .backface-hidden {
            backface-visibility: hidden;
        }

        /* Image Optimization */
        img {
            max-width: 100%;
            height: auto;
        }

        /* Font Loading Optimization */
        .font-loading {
            font-display: swap;
        }

        /* Safe Areas for iPhone X+ */
        .safe-area-bottom {
            padding-bottom: env(safe-area-inset-bottom, 20px);
        }

        .safe-area-top {
            padding-top: env(safe-area-inset-top, 20px);
        }
        
        /* Error State */
        .error-state {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border-color: #f87171;
        }
        
        /* Pin shimmer effect */
        .shimmer {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            color: transparent;
            border-radius: 4px;
        }
    </style>
</head>
<body class="min-h-screen bg-slate-50 safe-area-bottom">

    <!-- Mobile Bottom Menu -->
    <div class="mobile-menu safe-area-bottom">
        <button onclick="showMobileMenu()" class="flex flex-col items-center p-2 text-purple-600">
            <i class="fa-solid fa-gauge text-lg"></i>
            <span class="text-xs mt-1">Dashboard</span>
        </button>
        <button onclick="showMobileTryout()" class="flex flex-col items-center p-2 text-slate-600">
            <i class="fa-solid fa-book-open text-lg"></i>
            <span class="text-xs mt-1">Tryout</span>
        </button>
        <button onclick="showMobileProgress()" class="flex flex-col items-center p-2 text-slate-600">
            <i class="fa-solid fa-chart-line text-lg"></i>
            <span class="text-xs mt-1">Progress</span>
        </button>
        <button onclick="showMobileProfile()" class="flex flex-col items-center p-2 text-slate-600">
            <i class="fa-solid fa-user text-lg"></i>
            <span class="text-xs mt-1">Profil</span>
        </button>
    </div>

    <!-- Bottom Sheet Backdrop -->
    <div id="bottomSheetBackdrop" class="bottom-sheet-backdrop" onclick="hideBottomSheet()"></div>

    <!-- Mobile Bottom Sheet -->
    <div id="mobileBottomSheet" class="bottom-sheet">
        <div class="p-4">
            <div class="flex justify-center mb-4">
                <div class="w-12 h-1 bg-slate-300 rounded-full"></div>
            </div>
            <div id="mobileSheetContent">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notification-toast" class="fixed top-4 right-4 z-50 hidden">
        <div class="bg-white rounded-xl shadow-lg border border-slate-200 p-4 max-w-sm animate-slideInRight">
            <div class="flex items-start gap-3">
                <div id="toast-icon" class="text-xl"></div>
                <div class="flex-1">
                    <h4 id="toast-title" class="font-bold text-slate-800"></h4>
                    <p id="toast-message" class="text-sm text-slate-600 mt-1"></p>
                </div>
                <button onclick="hideToast()" class="text-slate-400 hover:text-slate-600 touch-button">
                    <i class="fa-solid fa-times"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Error State (Hidden by default) -->
    <div id="errorState" class="hidden error-state rounded-2xl p-6 mb-6 border border-red-300">
        <div class="flex items-center gap-3">
            <div class="w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center">
                <i class="fa-solid fa-triangle-exclamation text-red-600 text-xl"></i>
            </div>
            <div>
                <h3 class="font-bold text-red-800 text-lg mb-1">Kesalahan Login</h3>
                <p id="errorMessage" class="text-red-700">PIN tidak ditemukan. Silakan login kembali.</p>
            </div>
        </div>
        <div class="mt-4">
            <button onclick="redirectToLogin()" class="bg-red-600 text-white font-bold px-6 py-3 rounded-xl hover:bg-red-700 transition-colors touch-button">
                <i class="fa-solid fa-right-to-bracket mr-2"></i>Kembali ke Login
            </button>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="bg-white border-b border-slate-200 sticky top-0 z-40 shadow-sm safe-area-top">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-3">
                <!-- Logo -->
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 bg-gradient-to-r from-purple-600 to-indigo-600 rounded-lg flex items-center justify-center mobile-hide">
                        <i class="fa-solid fa-crown text-white text-sm"></i>
                    </div>
                    <div class="mobile-text-center">
                        <h1 class="font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-indigo-600 text-base sm:text-lg">
                            KERJA JADI <span class="text-yellow-500">ASN</span>
                        </h1>
                        <p class="text-[10px] sm:text-xs text-slate-500 font-semibold">Paket 2 Premium</p>
                    </div>
                </div>

                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center gap-4">
                    <div class="text-right">
                        <p class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">PIN Peserta</p>
                        <div class="flex items-center gap-2">
                            <p id="displayPin" class="text-sm font-black text-slate-800 tracking-wide font-mono shimmer">MEMUAT...</p>
                            <button onclick="copyPin()" class="text-slate-400 hover:text-purple-600 touch-button">
                                <i class="fa-regular fa-copy text-xs"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Profile Dropdown -->
                    <div class="relative">
                        <button onclick="toggleProfileMenu()" class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-50 to-indigo-50 border border-purple-100 flex items-center justify-center hover:shadow-md transition-all touch-button">
                            <i class="fa-solid fa-user text-purple-600"></i>
                        </button>

                        <div id="profileMenu" class="absolute right-0 top-12 w-56 bg-white rounded-xl shadow-lg border border-slate-200 py-2 hidden z-50 animate-fadeIn">
                            <div class="px-4 py-3 border-b border-slate-100">
                                <p class="text-xs font-bold text-slate-500 uppercase mb-1">Paket 2 Premium</p>
                                <p id="menuPin" class="text-sm font-black text-slate-800 truncate shimmer">MEMUAT...</p>
                                <p class="text-xs text-slate-500 mt-1">15 Tryout + Materi Lengkap</p>
                            </div>

                            <div class="py-1">
                                <a href="#" onclick="showProgressModal()" class="touch-link text-sm text-slate-700 hover:bg-purple-50 hover:text-purple-600 transition-colors flex items-center gap-3 px-4 py-2">
                                    <i class="fa-solid fa-chart-line w-5 text-purple-500"></i>
                                    Progress Belajar
                                </a>
                                <a href="#" onclick="showRankingModal()" class="touch-link text-sm text-slate-700 hover:bg-purple-50 hover:text-purple-600 transition-colors flex items-center gap-3 px-4 py-2">
                                    <i class="fa-solid fa-trophy w-5 text-yellow-500"></i>
                                    Ranking Nasional
                                </a>
                                <a href="#" onclick="showSettings()" class="touch-link text-sm text-slate-700 hover:bg-purple-50 hover:text-purple-600 transition-colors flex items-center gap-3 px-4 py-2">
                                    <i class="fa-solid fa-gear w-5 text-slate-500"></i>
                                    Pengaturan
                                </a>
                            </div>

                            <div class="border-t border-slate-100 my-1"></div>

                            <div class="py-1">
                                <a href="#" onclick="showHelpModal()" class="touch-link text-sm text-slate-700 hover:bg-purple-50 hover:text-purple-600 transition-colors flex items-center gap-3 px-4 py-2">
                                    <i class="fa-solid fa-circle-question w-5 text-green-500"></i>
                                    Bantuan
                                </a>
                                <a href="#" onclick="confirmLogout()" class="touch-link text-sm text-red-600 hover:bg-red-50 transition-colors flex items-center gap-3 px-4 py-2">
                                    <i class="fa-solid fa-arrow-right-from-bracket w-5"></i>
                                    Keluar
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mobile Hamburger Menu -->
                <button onclick="showMobileMenu()" class="md:hidden touch-button text-slate-600">
                    <i class="fa-solid fa-bars text-xl"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Mobile PIN Display -->
    <div class="md:hidden bg-white border-b border-slate-200 py-2">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <i class="fa-solid fa-id-card text-purple-600 text-sm"></i>
                    <p class="text-xs font-bold text-slate-500">PIN:</p>
                    <p id="mobilePin" class="text-sm font-black text-slate-800 font-mono shimmer">MEMUAT...</p>
                </div>
                <button onclick="copyPin()" class="text-slate-400 hover:text-purple-600 touch-button">
                    <i class="fa-regular fa-copy text-xs"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content (Hidden by default until PIN is loaded) -->
    <main id="mainContent" class="container mx-auto px-4 py-4 sm:py-6 hidden">
        <!-- Session Warning -->
        <div id="sessionWarning" class="mb-4 sm:mb-6 bg-yellow-50 border border-yellow-200 rounded-xl p-4 hidden">
            <div class="flex items-center justify-between mobile-stack gap-3">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center">
                        <i class="fa-solid fa-clock text-yellow-600"></i>
                    </div>
                    <div>
                        <p class="text-sm font-bold text-yellow-800 mobile-text-center">Sesi akan berakhir: <span id="sessionCountdown" class="font-mono"></span></p>
                        <p class="text-xs text-yellow-700 mobile-text-center">Simpan progress Anda</p>
                    </div>
                </div>
                <button onclick="extendSession()" class="text-sm font-bold text-yellow-700 hover:text-yellow-800 touch-button whitespace-nowrap">
                    <i class="fa-solid fa-plus"></i> Perpanjang
                </button>
            </div>
        </div>

        <!-- Welcome Banner -->
        <div class="premium-gradient rounded-2xl p-4 sm:p-6 md:p-8 mb-6 text-white relative overflow-hidden shadow-xl animate-fadeIn">
            <div class="relative z-10">
                <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-4 sm:gap-6">
                    <div class="flex-1">
                        <div class="flex flex-wrap items-center gap-2 mb-3">
                            <div class="w-10 h-10 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center mobile-hide">
                                <i class="fa-solid fa-crown text-yellow-300"></i>
                            </div>
                            <div class="flex flex-wrap gap-2">
                                <span class="status-badge bg-white/20 backdrop-blur-sm border border-white/30">Paket 2 Premium</span>
                                <span class="status-badge bg-yellow-500 border border-yellow-300 mobile-hide"><i class="fa-solid fa-trophy mr-1"></i>Ranking #<span id="userRank">-</span></span>
                            </div>
                        </div>

                        <h2 class="text-xl sm:text-2xl md:text-3xl font-bold mb-3 mobile-text-center lg:text-left">Akses Lengkap Persiapan ASN!</h2>
                        <p class="text-purple-100 opacity-95 mb-4 sm:mb-6 max-w-2xl mobile-text-center lg:text-left text-sm sm:text-base">
                            15 tryout premium + modul materi lengkap SKD + ranking nasional!
                        </p>

                        <div class="flex flex-wrap gap-3 mb-4">
                            <div class="flex items-center gap-3 bg-white/10 border border-white/20 px-3 sm:px-4 py-3 rounded-xl backdrop-blur-sm mobile-full sm:mobile-full md:w-auto">
                                <div class="w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-lg flex items-center justify-center shadow-lg">
                                    <i class="fa-solid fa-id-card-clip text-sm sm:text-base"></i>
                                </div>
                                <div>
                                    <p class="text-[10px] sm:text-[11px] font-bold text-purple-100 uppercase mb-1">ID Peserta</p>
                                    <p id="welcomePin" class="text-base sm:text-lg md:text-xl font-black tracking-wide font-mono shimmer">-------</p>
                                </div>
                            </div>

                            <div class="flex items-center gap-3 bg-white/10 border border-white/20 px-3 sm:px-4 py-3 rounded-xl backdrop-blur-sm mobile-full sm:mobile-full md:w-auto">
                                <div class="w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-br from-green-400 to-emerald-500 rounded-lg flex items-center justify-center shadow-lg">
                                    <i class="fa-solid fa-bolt text-sm sm:text-base"></i>
                                </div>
                                <div>
                                    <p class="text-[10px] sm:text-[11px] font-bold text-purple-100 uppercase mb-1">Status</p>
                                    <div class="flex items-center gap-2">
                                        <div id="sessionIndicator" class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                        <p id="sessionTimer" class="text-sm font-bold">Aktif</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="flex flex-wrap gap-2">
                            <button onclick="scrollToTryout()" class="bg-white text-purple-700 font-bold px-4 sm:px-6 py-2 sm:py-3 rounded-xl hover:bg-purple-50 transition-all shadow-lg touch-button touch-feedback mobile-full sm:mobile-full md:w-auto">
                                <i class="fa-solid fa-play mr-2"></i> Mulai Tryout
                            </button>
                            <button onclick="showRankingModal()" class="bg-white/20 backdrop-blur-sm border border-white/30 text-white font-bold px-4 sm:px-6 py-2 sm:py-3 rounded-xl hover:bg-white/30 transition-all shadow-lg touch-button touch-feedback mobile-full sm:mobile-full md:w-auto">
                                <i class="fa-solid fa-trophy mr-2"></i> Lihat Ranking
                            </button>
                        </div>
                    </div>

                    <!-- Hero Illustration - Hide on very small screens -->
                    <div class="hidden lg:block">
                        <div class="w-48 h-48 relative">
                            <div class="absolute inset-0 bg-white/10 rounded-full backdrop-blur-sm"></div>
                            <div class="absolute inset-4 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full flex items-center justify-center">
                                <i class="fa-solid fa-gem text-5xl sm:text-6xl text-white"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Grid -->
        <div class="grid lg:grid-cols-3 gap-4 sm:gap-6 md:gap-8">
            <!-- Main Content -->
            <div class="lg:col-span-2 space-y-4 sm:space-y-6 desktop-main">
                <!-- Materi Lengkap SKD -->
                <div class="bg-white rounded-2xl p-4 sm:p-6 shadow-sm border border-slate-200 card-hover mobile-card">
                    <div class="flex items-center gap-3 mb-4 sm:mb-6 mobile-stack">
                        <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-pink-600 rounded-lg flex items-center justify-center">
                            <i class="fa-solid fa-book-open text-white"></i>
                        </div>
                        <div class="mobile-text-center lg:text-left">
                            <h3 class="font-bold text-slate-800 text-lg sm:text-xl">Materi Lengkap SKD</h3>
                            <p class="text-sm text-slate-600">Pelajari modul TWK, TIU, dan TKP</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
                        <!-- TWK Card -->
                        <div class="group">
                            <div class="p-4 bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl border border-blue-200 hover:border-blue-400 transition-all mobile-card">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center shadow-sm">
                                        <i class="fa-solid fa-book-bookmark text-blue-600"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-slate-800 text-base">Modul TWK</h4>
                                        <p class="text-xs text-slate-500">Wawasan Kebangsaan</p>
                                    </div>
                                </div>
                                <p class="text-sm text-slate-600 mb-3 line-clamp-2">Pancasila, UUD 1945, NKRI, Bhinneka Tunggal Ika</p>
                                <button onclick="openMateri('twk')" class="w-full text-blue-600 text-sm font-bold py-2 rounded-lg hover:bg-blue-50 transition-colors touch-button touch-feedback flex items-center justify-center gap-1">
                                    <span>Buka Modul</span>
                                    <i class="fa-solid fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>

                        <!-- TIU Card -->
                        <div class="group">
                            <div class="p-4 bg-gradient-to-br from-green-50 to-green-100 rounded-xl border border-green-200 hover:border-green-400 transition-all mobile-card">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center shadow-sm">
                                        <i class="fa-solid fa-calculator text-green-600"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-slate-800 text-base">Modul TIU</h4>
                                        <p class="text-xs text-slate-500">Tes Intelegensi Umum</p>
                                    </div>
                                </div>
                                <p class="text-sm text-slate-600 mb-3 line-clamp-2">Verbal, Numerik, Logika, Analitik, dan Figural</p>
                                <button onclick="openMateri('tiu')" class="w-full text-green-600 text-sm font-bold py-2 rounded-lg hover:bg-green-50 transition-colors touch-button touch-feedback flex items-center justify-center gap-1">
                                    <span>Buka Modul</span>
                                    <i class="fa-solid fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>

                        <!-- TKP Card -->
                        <div class="group">
                            <div class="p-4 bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl border border-purple-200 hover:border-purple-400 transition-all mobile-card">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center shadow-sm">
                                        <i class="fa-solid fa-users-gear text-purple-600"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-slate-800 text-base">Modul TKP</h4>
                                        <p class="text-xs text-slate-500">Karakteristik Pribadi</p>
                                    </div>
                                </div>
                                <p class="text-sm text-slate-600 mb-3 line-clamp-2">Pelayanan Publik, Integritas, Semangat Gotong Royong</p>
                                <button onclick="openMateri('tkp')" class="w-full text-purple-600 text-sm font-bold py-2 rounded-lg hover:bg-purple-50 transition-colors touch-button touch-feedback flex items-center justify-center gap-1">
                                    <span>Buka Modul</span>
                                    <i class="fa-solid fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Simulasi Tryout Section -->
                <div id="tryoutSection" class="space-y-4">
                    <!-- Header -->
                    <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3 mb-2">
                        <div>
                            <h3 class="font-bold text-slate-800 text-lg sm:text-xl flex items-center gap-2 mobile-stack">
                                <i class="fa-solid fa-laptop-code text-purple-600"></i>
                                Simulasi Tryout (15 Paket)
                            </h3>
                            <p class="text-sm text-slate-600 mt-1">Pilih paket tryout untuk dikerjakan</p>
                        </div>

                        <div class="flex items-center gap-3 mobile-stack">
                            <div class="bg-purple-50 rounded-lg px-3 py-2 mobile-full sm:w-auto">
                                <p class="text-xs text-slate-500 font-bold uppercase">Selesai</p>
                                <div class="flex items-center gap-2">
                                    <span id="completedCount" class="text-lg font-black text-purple-600">0</span>
                                    <span class="text-slate-400">/</span>
                                    <span class="text-slate-700 font-bold">15</span>
                                </div>
                            </div>

                            <div class="flex items-center gap-2">
                                <button onclick="refreshSoalList()" class="w-9 h-9 rounded-lg bg-slate-100 hover:bg-slate-200 flex items-center justify-center transition-colors touch-button">
                                    <i class="fa-solid fa-rotate text-slate-600"></i>
                                </button>
                                <button onclick="toggleSort()" id="sortButton" class="w-9 h-9 rounded-lg bg-slate-100 hover:bg-slate-200 flex items-center justify-center transition-colors touch-button">
                                    <i class="fa-solid fa-arrow-down-a-z text-slate-600"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Filter Tabs -->
                    <div class="flex gap-2 mb-4 overflow-x-auto pb-2">
                        <button onclick="filterSoal('all')" id="filter-all" class="px-4 py-2 rounded-lg bg-gradient-to-r from-purple-600 to-indigo-600 text-white text-sm font-bold transition-colors whitespace-nowrap touch-button">
                            Semua (15)
                        </button>
                        <button onclick="filterSoal('completed')" id="filter-completed" class="px-4 py-2 rounded-lg bg-slate-100 hover:bg-slate-200 text-slate-700 text-sm font-bold transition-colors whitespace-nowrap touch-button">
                            <i class="fa-solid fa-check mr-2 text-green-500"></i>Selesai
                        </button>
                        <button onclick="filterSoal('pending')" id="filter-pending" class="px-4 py-2 rounded-lg bg-slate-100 hover:bg-slate-200 text-slate-700 text-sm font-bold transition-colors whitespace-nowrap touch-button">
                            <i class="fa-solid fa-clock mr-2 text-yellow-500"></i>Belum
                        </button>
                    </div>

                    <!-- Loading State -->
                    <div id="loadingState" class="space-y-3">
                        <!-- Skeleton Loaders -->
                        <div class="bg-white p-4 rounded-2xl border border-slate-200 mobile-card">
                            <div class="flex items-center gap-3">
                                <div class="loading-skeleton w-10 h-10 rounded-xl"></div>
                                <div class="flex-1 space-y-2">
                                    <div class="loading-skeleton h-4 w-40 rounded"></div>
                                    <div class="loading-skeleton h-3 w-24 rounded"></div>
                                </div>
                                <div class="loading-skeleton w-20 h-9 rounded-xl"></div>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded-2xl border border-slate-200 mobile-card">
                            <div class="flex items-center gap-3">
                                <div class="loading-skeleton w-10 h-10 rounded-xl"></div>
                                <div class="flex-1 space-y-2">
                                    <div class="loading-skeleton h-4 w-40 rounded"></div>
                                    <div class="loading-skeleton h-3 w-24 rounded"></div>
                                </div>
                                <div class="loading-skeleton w-20 h-9 rounded-xl"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Soal List Container -->
                    <div id="soalListContainer" class="space-y-3 hidden">
                        <!-- Soal cards will be dynamically inserted here -->
                    </div>

                    <!-- Empty State -->
                    <div id="emptyState" class="hidden text-center py-8">
                        <div class="w-16 h-16 bg-purple-50 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fa-solid fa-inbox text-purple-500 text-2xl"></i>
                        </div>
                        <h3 class="text-lg font-bold text-slate-800 mb-2">Belum Ada Paket Tersedia</h3>
                        <p class="text-slate-600 mb-4">Semua paket tryout sedang dalam persiapan.</p>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="space-y-4 sm:space-y-6 desktop-sidebar">
                <!-- Account Status Card -->
                <div class="bg-white rounded-2xl p-4 sm:p-6 shadow-sm border border-slate-200 card-hover mobile-card">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-pink-600 rounded-lg flex items-center justify-center">
                            <i class="fa-solid fa-user-check text-white"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-slate-800 text-base sm:text-lg">Status Akun</h4>
                            <p class="text-xs text-slate-500">Paket 2 Premium</p>
                        </div>
                    </div>

                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center gap-2">
                                <i class="fa-solid fa-crown text-purple-500 text-sm"></i>
                                <span class="text-sm font-medium text-slate-700">Masa Aktif</span>
                            </div>
                            <span class="font-bold text-green-600 text-sm">Selamanya</span>
                        </div>

                        <div class="flex justify-between items-center">
                            <div class="flex items-center gap-2">
                                <i class="fa-solid fa-layer-group text-purple-500 text-sm"></i>
                                <span class="text-sm font-medium text-slate-700">Kuota Tryout</span>
                            </div>
                            <span class="font-bold text-purple-600 text-sm">15 Paket</span>
                        </div>

                        <div class="pt-2">
                            <div class="flex justify-between text-xs text-slate-500 mb-1">
                                <span>Progress Tryout</span>
                                <span id="quotaUsed">0/15</span>
                            </div>
                            <div class="w-full bg-slate-100 h-2 rounded-full overflow-hidden">
                                <div id="quotaProgress" class="h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full progress-bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Progress Ring Card -->
                <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl p-4 sm:p-6 border border-purple-100 card-hover mobile-card">
                    <h4 class="font-bold text-slate-800 mb-4 text-center text-base sm:text-lg">Progress Keseluruhan</h4>

                    <div class="flex flex-col items-center justify-center mb-4">
                        <div class="relative w-32 h-32 sm:w-40 sm:h-40 mb-4">
                            <svg class="w-full h-full transform -rotate-90" viewBox="0 0 36 36">
                                <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                                    fill="none" stroke="#e2e8f0" stroke-width="3"/>
                                <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                                    fill="none" stroke="url(#gradient2)" stroke-width="3"
                                    stroke-dasharray="100, 100" stroke-linecap="round" id="progressRing"/>
                                <defs>
                                    <linearGradient id="gradient2" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" stop-color="#8b5cf6" />
                                        <stop offset="100%" stop-color="#ec4899" />
                                    </linearGradient>
                                </defs>
                            </svg>
                            <div class="absolute inset-0 flex flex-col items-center justify-center">
                                <span id="progressPercentage" class="text-2xl sm:text-3xl font-black text-slate-800">0%</span>
                                <span class="text-xs text-slate-500 mt-1">Selesai</span>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4 w-full">
                            <div class="text-center">
                                <div class="text-xl sm:text-2xl font-black text-purple-600" id="completedCountSmall">0</div>
                                <div class="text-xs sm:text-sm text-slate-500">Terselesaikan</div>
                            </div>
                            <div class="text-center">
                                <div class="text-xl sm:text-2xl font-black text-slate-800" id="remainingCount">15</div>
                                <div class="text-xs sm:text-sm text-slate-500">Tersisa</div>
                            </div>
                        </div>
                    </div>

                    <button onclick="showProgressModal()" class="w-full bg-white border border-purple-200 text-purple-600 font-bold py-2 sm:py-3 rounded-xl hover:bg-purple-50 transition-colors touch-button touch-feedback flex items-center justify-center gap-2 text-sm">
                        <i class="fa-solid fa-chart-simple"></i> Detail Progress
                    </button>
                </div>

                <!-- Grup WhatsApp VIP -->
                <div class="bg-gradient-to-br from-green-900 to-emerald-900 rounded-2xl p-4 sm:p-6 shadow-lg card-hover mobile-card">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center">
                            <i class="fa-brands fa-whatsapp text-white"></i>
                        </div>
                        <div>
                            <h4 class="font-black text-white text-base sm:text-lg">Grup VIP</h4>
                            <p class="text-white/90 text-xs">Akses eksklusif Paket 2</p>
                        </div>
                    </div>

                    <div class="space-y-3 mb-4">
                        <div class="flex items-center gap-2">
                            <i class="fa-solid fa-user-tie text-white/80 text-sm"></i>
                            <p class="text-white text-sm">Mentor Berpengalaman</p>
                        </div>
                        <div class="flex items-center gap-2">
                            <i class="fa-solid fa-comments text-white/80 text-sm"></i>
                            <p class="text-white text-sm">Diskusi Intensif</p>
                        </div>
                    </div>

                    <button onclick="joinWhatsAppGroup()" class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold py-3 rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all touch-button touch-feedback flex items-center justify-center gap-2 text-sm">
                        <i class="fa-brands fa-whatsapp"></i> Join Grup WhatsApp
                    </button>

                    <p class="text-white/80 text-xs text-center mt-3">
                        <i class="fa-solid fa-users"></i> 200+ member aktif
                    </p>
                </div>

                <!-- Paket Tambahan -->
                <div class="bg-gradient-to-br from-amber-400 via-orange-400 to-yellow-500 rounded-2xl p-4 sm:p-6 shadow-lg card-hover mobile-card">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center">
                            <i class="fa-solid fa-plus text-white"></i>
                        </div>
                        <div>
                            <h4 class="font-black text-white text-base sm:text-lg">Butuh Lebih?</h4>
                            <p class="text-white/90 text-xs">Tambahan tryout premium</p>
                        </div>
                    </div>

                    <div class="bg-white/20 backdrop-blur-sm rounded-xl p-3 mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-white text-sm font-bold">+1 Paket Tryout</span>
                            <span class="bg-white text-amber-600 px-2 py-1 rounded-full text-xs font-black">Rp 25.000</span>
                        </div>
                        <p class="text-white/90 text-xs">Dengan pembahasan lengkap</p>
                    </div>

                    <button onclick="tambahPaket()" class="w-full bg-white text-amber-700 font-bold py-3 rounded-xl hover:bg-gray-100 transition-all touch-button touch-feedback flex items-center justify-center gap-2 text-sm">
                        <i class="fa-solid fa-cart-shopping"></i> Beli Paket Tambahan
                    </button>
                </div>

                <!-- Quick Stats -->
                <div class="bg-white rounded-2xl p-4 sm:p-6 shadow-sm border border-slate-200 mobile-card">
                    <h4 class="font-bold text-slate-800 mb-4 text-base sm:text-lg">Statistik Cepat</h4>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="bg-slate-50 rounded-xl p-3 text-center">
                            <div class="text-lg sm:text-2xl font-black text-purple-600" id="avgScore">-</div>
                            <div class="text-xs text-slate-500">Rata-rata</div>
                        </div>
                        <div class="bg-slate-50 rounded-xl p-3 text-center">
                            <div class="text-lg sm:text-2xl font-black text-green-600" id="bestScore">-</div>
                            <div class="text-xs text-slate-500">Terbaik</div>
                        </div>
                        <div class="bg-slate-50 rounded-xl p-3 text-center">
                            <div class="text-lg sm:text-2xl font-black text-blue-600" id="totalTime">0</div>
                            <div class="text-xs text-slate-500">Jam</div>
                        </div>
                        <div class="bg-slate-50 rounded-xl p-3 text-center">
                            <div class="text-lg sm:text-2xl font-black text-red-600" id="accuracy">-</div>
                            <div class="text-xs text-slate-500">Akurasi</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="mt-8 sm:mt-12 pt-6 sm:pt-8 pb-16 sm:pb-10 border-t border-slate-200 bg-white">
        <div class="container mx-auto px-4">
            <div class="flex flex-col lg:flex-row justify-between items-center gap-4 sm:gap-6">
                <div class="text-center lg:text-left">
                    <div class="flex items-center justify-center lg:justify-start gap-2 mb-3">
                        <div class="w-8 h-8 bg-gradient-to-r from-purple-600 to-indigo-600 rounded-lg flex items-center justify-center">
                            <i class="fa-solid fa-crown text-white text-sm"></i>
                        </div>
                        <h2 class="font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-indigo-600 text-base sm:text-lg">
                            KERJA JADI <span class="text-yellow-500">ASN</span>
                        </h2>
                    </div>
                    <p class="text-slate-500 text-xs sm:text-sm max-w-md">
                        Platform tryout ASN premium dengan 15 paket tryout, materi SKD, dan grup belajar VIP.
                    </p>
                </div>

                <div class="text-center lg:text-right">
                    <div class="flex justify-center lg:justify-end gap-3 sm:gap-4 mb-3">
                        <a href="https://wa.me/6285696409288" target="_blank" class="text-slate-400 hover:text-green-600">
                            <i class="fab fa-whatsapp text-lg"></i>
                        </a>
                        <a href="#" class="text-slate-400 hover:text-pink-600">
                            <i class="fab fa-instagram text-lg"></i>
                        </a>
                        <a href="#" class="text-slate-400 hover:text-blue-600">
                            <i class="fab fa-facebook text-lg"></i>
                        </a>
                    </div>
                    <p class="text-slate-400 text-xs font-bold uppercase tracking-widest">
                        &copy; <span id="currentYear">2026</span> Kerja Jadi ASN
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Modals -->
    <!-- Progress Modal -->
    <div id="progressModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center z-50 hidden p-4">
        <div class="bg-white rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden mt-4">
            <div class="sticky top-0 bg-white border-b border-slate-200 p-4 sm:p-6 flex justify-between items-center">
                <div>
                    <h3 class="text-lg sm:text-xl font-bold text-slate-800">Detail Progress</h3>
                    <p class="text-xs sm:text-sm text-slate-500">PIN: <span id="modalPin" class="font-mono font-bold"></span></p>
                </div>
                <button onclick="hideProgressModal()" class="text-slate-400 hover:text-slate-600 text-xl touch-button">
                    <i class="fa-solid fa-times"></i>
                </button>
            </div>

            <div class="p-4 sm:p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
                <div id="progressContent"></div>
            </div>
        </div>
    </div>

    <!-- Ranking Modal -->
    <div id="rankingModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center z-50 hidden p-4">
        <div class="bg-white rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden mt-4">
            <div class="sticky top-0 bg-white border-b border-slate-200 p-4 sm:p-6 flex justify-between items-center">
                <div>
                    <h3 class="text-lg sm:text-xl font-bold text-slate-800">Ranking Nasional</h3>
                    <p class="text-xs sm:text-sm text-slate-500">Peringkat peserta Paket 2</p>
                </div>
                <button onclick="hideRankingModal()" class="text-slate-400 hover:text-slate-600 text-xl touch-button">
                    <i class="fa-solid fa-times"></i>
                </button>
            </div>

            <div class="p-4 sm:p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
                <div id="rankingContent"></div>
            </div>
        </div>
    </div>

    <script>
        // ========== 1. GLOBAL VARIABLES ==========
        let pinAkses = null;
        let sessionInterval = null;
        let sessionTimer = null;
        let isSortedAsc = true;
        let currentFilter = 'all';
        let userRank = 0;

        // ========== 2. PIN HANDLING FUNCTIONS ==========
        function getPinFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('pin');
        }

        function getPinFromStorage() {
            // Coba dari berbagai sumber storage
            return localStorage.getItem('pinAkses') || 
                   sessionStorage.getItem('pinAkses') ||
                   localStorage.getItem('userPin') ||
                   sessionStorage.getItem('userPin');
        }

        function validatePin(pin) {
            if (!pin) {
                return {
                    valid: false,
                    message: 'PIN tidak ditemukan. Silakan login kembali.'
                };
            }
            
            // Minimal 4 karakter, bisa huruf dan angka
            if (pin.length < 4) {
                return {
                    valid: false,
                    message: 'Format PIN tidak valid. Minimal 4 karakter.'
                };
            }
            
            // Boleh huruf dan angka saja
            if (!/^[a-zA-Z0-9]+$/.test(pin)) {
                return {
                    valid: false,
                    message: 'Format PIN tidak valid. Hanya boleh huruf dan angka.'
                };
            }
            
            return {
                valid: true,
                message: 'PIN valid'
            };
        }

        function savePin(pin) {
            // Simpan ke berbagai storage untuk redundancy
            localStorage.setItem('pinAkses', pin);
            sessionStorage.setItem('pinAkses', pin);
            localStorage.setItem('userPin', pin);
            localStorage.setItem(`paket_peserta_${pin}`, "2");
            
            // Simpan juga di cookies untuk session management
            document.cookie = `pinAkses=${pin}; path=/; max-age=86400`; // 24 jam
            document.cookie = `paket=2; path=/; max-age=86400`;
        }

        // ========== 3. INITIALIZATION ==========
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Dashboard Paket 2 initializing...');

            // Set current year in footer
            document.getElementById('currentYear').textContent = new Date().getFullYear();

            // Setup event listeners
            setupEventListeners();

            // Initialize dashboard
            await initializeDashboard();

            // Handle orientation change
            window.addEventListener('orientationchange', handleOrientationChange);
            window.addEventListener('resize', handleResize);

            console.log('Dashboard Paket 2 initialized successfully');
        });

        async function initializeDashboard() {
            try {
                // 1. Get PIN from various sources
                pinAkses = getPinFromURL() || getPinFromStorage();
                
                // 2. Validate PIN
                const validation = validatePin(pinAkses);
                if (!validation.valid) {
                    throw new Error(validation.message);
                }

                // 3. Save PIN for future use
                savePin(pinAkses);

                // 4. Update UI with PIN
                updatePINDisplays();

                // 5. Show main content
                document.getElementById('mainContent').classList.remove('hidden');
                document.getElementById('errorState').classList.add('hidden');

                // 6. Load soal list
                await renderSoalList();

                // 7. Update progress and stats
                updateProgressStats();

                // 8. Update ranking
                updateRanking();

                // 9. Show welcome notification
                showNotification('success', 'Berhasil Login!', `Selamat datang di dashboard Paket 2 Premium!`);

                // 10. Adjust layout for current screen size
                updateLayout();

            } catch (error) {
                console.error('Initialization error:', error);
                showErrorState(error.message || 'Terjadi kesalahan saat login. Silakan login kembali.');
            }
        }

        function showErrorState(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorState').classList.remove('hidden');
            document.getElementById('mainContent').classList.add('hidden');
        }

        function redirectToLogin() {
            // Clear all storage
            localStorage.clear();
            sessionStorage.clear();
            
            // Redirect to login
            window.location.href = 'login.html';
        }

        // ========== 4. PIN DISPLAY FUNCTIONS ==========
        function updatePINDisplays() {
            // Update all PIN displays
            const pinElements = [
                'displayPin',
                'welcomePin',
                'menuPin',
                'modalPin',
                'mobilePin'
            ];

            pinElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = pinAkses;
                    element.classList.remove('shimmer');
                }
            });
        }

        function copyPin() {
            if (!pinAkses) {
                showNotification('error', 'Gagal Menyalin', 'PIN belum tersedia');
                return;
            }

            navigator.clipboard.writeText(pinAkses)
                .then(() => {
                    showNotification('success', 'PIN Disalin', 'PIN telah disalin ke clipboard');
                })
                .catch(err => {
                    console.error('Failed to copy PIN:', err);
                    showNotification('error', 'Gagal Menyalin', 'Tidak dapat menyalin PIN');
                });
        }

        // ========== 5. RESPONSIVE FUNCTIONS ==========
        function handleOrientationChange() {
            setTimeout(() => {
                updateLayout();
            }, 100);
        }

        function handleResize() {
            debounce(updateLayout, 250);
        }

        function updateLayout() {
            const isMobile = window.innerWidth < 768;
            
            if (isMobile) {
                document.querySelectorAll('.text-adjust').forEach(el => {
                    if (window.innerWidth < 400) {
                        el.style.fontSize = '0.875rem';
                    }
                });
            }
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // ========== 6. MOBILE MENU FUNCTIONS ==========
        function showMobileMenu() {
            const content = `
                <div class="space-y-3">
                    <h3 class="font-bold text-slate-800 text-lg mb-2">Menu Utama</h3>
                    <button onclick="scrollToTryout()" class="w-full text-left p-3 rounded-lg bg-purple-50 text-purple-700 font-medium flex items-center gap-3">
                        <i class="fa-solid fa-play text-purple-600"></i>
                        <span>Mulai Tryout</span>
                    </button>
                    <button onclick="showProgressModal()" class="w-full text-left p-3 rounded-lg bg-slate-100 text-slate-700 font-medium flex items-center gap-3">
                        <i class="fa-solid fa-chart-line text-slate-600"></i>
                        <span>Progress Belajar</span>
                    </button>
                    <button onclick="showRankingModal()" class="w-full text-left p-3 rounded-lg bg-slate-100 text-slate-700 font-medium flex items-center gap-3">
                        <i class="fa-solid fa-trophy text-yellow-600"></i>
                        <span>Ranking Nasional</span>
                    </button>
                    <button onclick="joinWhatsAppGroup()" class="w-full text-left p-3 rounded-lg bg-green-50 text-green-700 font-medium flex items-center gap-3">
                        <i class="fa-brands fa-whatsapp text-green-600"></i>
                        <span>Grup WhatsApp VIP</span>
                    </button>
                    <div class="pt-4 border-t border-slate-200">
                        <button onclick="showSettings()" class="w-full text-left p-3 rounded-lg bg-slate-100 text-slate-700 font-medium flex items-center gap-3">
                            <i class="fa-solid fa-gear text-slate-600"></i>
                            <span>Pengaturan</span>
                        </button>
                        <button onclick="confirmLogout()" class="w-full text-left p-3 rounded-lg bg-red-50 text-red-700 font-medium flex items-center gap-3 mt-2">
                            <i class="fa-solid fa-arrow-right-from-bracket text-red-600"></i>
                            <span>Keluar</span>
                        </button>
                    </div>
                </div>
            `;
            
            showBottomSheet(content);
        }

        function showMobileTryout() {
            scrollToTryout();
        }

        function showMobileProgress() {
            showProgressModal();
        }

        function showMobileProfile() {
            if (!pinAkses) return;
            
            const content = `
                <div class="space-y-4">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-r from-purple-500 to-pink-600 rounded-full flex items-center justify-center mx-auto mb-3">
                            <i class="fa-solid fa-user text-white text-2xl"></i>
                        </div>
                        <h3 class="font-bold text-slate-800">Profil Peserta</h3>
                        <p class="text-sm text-slate-500">PIN: ${pinAkses}</p>
                    </div>
                    
                    <div class="space-y-2">
                        <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                            <span class="text-slate-700">Paket</span>
                            <span class="font-bold text-purple-600">2 Premium</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                            <span class="text-slate-700">Masa Aktif</span>
                            <span class="font-bold text-green-600">Selamanya</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                            <span class="text-slate-700">Tryout Tersedia</span>
                            <span class="font-bold text-purple-600">15 Paket</span>
                        </div>
                    </div>
                    
                    <button onclick="showProgressModal()" class="w-full bg-purple-600 text-white font-bold py-3 rounded-xl mt-4">
                        Lihat Detail Progress
                    </button>
                </div>
            `;
            
            showBottomSheet(content);
        }

        function showBottomSheet(content) {
            document.getElementById('mobileSheetContent').innerHTML = content;
            document.getElementById('mobileBottomSheet').classList.add('active');
            document.getElementById('bottomSheetBackdrop').classList.add('active');
            
            // Disable body scroll
            document.body.style.overflow = 'hidden';
        }

        function hideBottomSheet() {
            document.getElementById('mobileBottomSheet').classList.remove('active');
            document.getElementById('bottomSheetBackdrop').classList.remove('active');
            
            // Enable body scroll
            document.body.style.overflow = '';
        }

        // ========== 7. SOAL LIST MANAGEMENT ==========
        async function renderSoalList() {
            try {
                if (!pinAkses) {
                    throw new Error('PIN tidak tersedia');
                }

                // Show loading state
                document.getElementById('loadingState').classList.remove('hidden');
                document.getElementById('soalListContainer').classList.add('hidden');
                document.getElementById('emptyState').classList.add('hidden');

                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 800));

                // Get progress data
                const progressKey = `progress_${pinAkses}`;
                const progress = JSON.parse(localStorage.getItem(progressKey)) || {};

                // Generate soal list (15 paket untuk paket 2)
                const soalList = [];
                for (let i = 1; i <= 15; i++) {
                    const isCompleted = progress[`paket_${i}`] || false;
                    const score = progress[`score_${i}`] || null;
                    const completionTime = progress[`time_${i}`] || null;
                    const accuracy = progress[`accuracy_${i}`] || null;

                    soalList.push({
                        id: i,
                        title: `Tryout #${i}`,
                        description: 'TWK  TIU  TKP (110 Soal)',
                        isCompleted,
                        score,
                        completionTime,
                        accuracy,
                        link: `soalpaket${i}.html?pin=${pinAkses}`,
                        bestScore: score && score >= 450
                    });
                }

                // Render soal list
                renderSoalCards(soalList);

                // Update completed count
                const completedCount = soalList.filter(s => s.isCompleted).length;
                updateCompletedCount(completedCount);

                // Update quick stats
                updateQuickStats(soalList);

                // Hide loading state
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('soalListContainer').classList.remove('hidden');

                // Apply current filter
                filterSoal(currentFilter);

            } catch (error) {
                console.error('Error rendering soal list:', error);
                document.getElementById('loadingState').classList.add('hidden');
                showNotification('error', 'Kesalahan', 'Gagal memuat daftar tryout');
            }
        }

        function renderSoalCards(soalList) {
            const container = document.getElementById('soalListContainer');
            container.innerHTML = '';

            if (soalList.length === 0) {
                document.getElementById('emptyState').classList.remove('hidden');
                return;
            }

            soalList.forEach((soal, index) => {
                const card = createSoalCard(soal, index);
                container.innerHTML += card;
            });
        }

        function createSoalCard(soal, index) {
            const isMobile = window.innerWidth < 768;
            const badge = soal.isCompleted 
                ? `<span class="status-badge status-completed"><i class="fa-solid fa-check mr-1"></i>Selesai</span>`
                : `<span class="status-badge status-pending"><i class="fa-solid fa-clock mr-1"></i>Belum</span>`;

            const scoreDisplay = soal.score 
                ? `<div class="text-xs font-bold ${soal.score >= 450 ? 'text-green-600' : 'text-yellow-600'}">
                        <i class="fa-solid fa-star"></i> ${soal.score}
                   </div>`
                : '';

            const buttonText = soal.isCompleted ? '<i class="fa-solid fa-redo"></i>' : '<i class="fa-solid fa-play"></i>';
            const buttonTitle = soal.isCompleted ? 'ULANGI' : 'KERJAKAN';
            const buttonClass = soal.isCompleted 
                ? 'bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700'
                : 'bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700';

            // Mobile optimized card
            if (isMobile) {
                return `
                    <div class="bg-white p-4 rounded-2xl border border-slate-200 touch-feedback mobile-card" data-id="${soal.id}" data-completed="${soal.isCompleted}" data-score="${soal.score || 0}" data-best="${soal.bestScore}">
                        <div class="flex items-center justify-between gap-3">
                            <div class="flex items-center gap-3 flex-1">
                                <div class="relative">
                                    <div class="w-10 h-10 ${soal.isCompleted ? 'bg-gradient-to-br from-green-100 to-emerald-100 text-green-600' : 'bg-gradient-to-br from-purple-50 to-pink-50 text-purple-600'} rounded-xl flex items-center justify-center font-black shadow-sm">
                                        ${soal.id}
                                    </div>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center gap-2 mb-1">
                                        <h4 class="font-bold text-slate-800 text-sm truncate">Tryout #${soal.id}</h4>
                                        ${badge}
                                    </div>
                                    <p class="text-xs text-slate-500 truncate">TWK  TIU  TKP</p>
                                    ${scoreDisplay}
                                </div>
                            </div>
                            <a href="${soal.link}" class="${buttonClass} text-white px-4 py-3 rounded-xl text-sm font-bold shadow-lg touch-button touch-feedback flex items-center justify-center" title="${buttonTitle}">
                                ${buttonText}
                            </a>
                        </div>
                    </div>
                `;
            }

            // Desktop card
            return `
                <div class="bg-white p-4 rounded-2xl border border-slate-200 card-hover" data-id="${soal.id}" data-completed="${soal.isCompleted}" data-score="${soal.score || 0}" data-best="${soal.bestScore}">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4 flex-1">
                            <div class="relative">
                                <div class="w-12 h-12 ${soal.isCompleted ? 'bg-gradient-to-br from-green-100 to-emerald-100 text-green-600' : 'bg-gradient-to-br from-purple-50 to-pink-50 text-purple-600'} rounded-xl flex items-center justify-center font-black shadow-sm">
                                    ${soal.id}
                                </div>
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-1">
                                    <h4 class="font-bold text-slate-800">Tryout #${soal.id}</h4>
                                    ${badge}
                                </div>
                                <p class="text-sm text-slate-500">TWK  TIU  TKP (110 Soal)</p>
                                ${scoreDisplay}
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <a href="${soal.link}" class="${buttonClass} text-white px-5 py-3 rounded-xl text-sm font-bold shadow-lg hover:shadow-xl transition-all touch-button flex items-center gap-2">
                                ${buttonText} ${buttonTitle}
                            </a>
                        </div>
                    </div>
                </div>
            `;
        }

        function updateCompletedCount(count) {
            const elements = [
                'completedCount',
                'completedCountSmall'
            ];

            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = count;
                }
            });

            document.getElementById('remainingCount').textContent = 15 - count;
            document.getElementById('quotaUsed').textContent = `${count}/15`;

            const progressPercentage = (count / 15) * 100;
            const progressBar = document.getElementById('quotaProgress');
            if (progressBar) {
                progressBar.style.width = `${progressPercentage}%`;
            }

            updateProgressRing(progressPercentage);
        }

        function updateProgressRing(percentage) {
            const progressRing = document.getElementById('progressRing');
            const progressPercentageElement = document.getElementById('progressPercentage');

            if (progressRing && progressPercentageElement) {
                const circumference = 2 * Math.PI * 15.9155;
                const dashOffset = circumference - (percentage / 100) * circumference;

                progressRing.setAttribute('stroke-dasharray', `${circumference} ${circumference}`);
                progressRing.setAttribute('stroke-dashoffset', dashOffset);

                progressPercentageElement.textContent = `${Math.round(percentage)}%`;
            }
        }

        function updateQuickStats(soalList) {
            const completedSoal = soalList.filter(s => s.isCompleted);
            
            if (completedSoal.length === 0) {
                return;
            }

            // Rata-rata skor
            const totalScore = completedSoal.reduce((sum, s) => sum + (s.score || 0), 0);
            const avgScore = Math.round(totalScore / completedSoal.length);
            document.getElementById('avgScore').textContent = avgScore;

            // Skor terbaik
            const bestScore = Math.max(...completedSoal.map(s => s.score || 0));
            document.getElementById('bestScore').textContent = bestScore;

            // Total waktu (dalam jam)
            const totalMinutes = completedSoal.reduce((sum, s) => sum + (s.completionTime || 0), 0);
            const totalHours = Math.round(totalMinutes / 60);
            document.getElementById('totalTime').textContent = totalHours;

            // Akurasi rata-rata
            const totalAccuracy = completedSoal.reduce((sum, s) => sum + (s.accuracy || 0), 0);
            const avgAccuracy = Math.round(totalAccuracy / completedSoal.length);
            document.getElementById('accuracy').textContent = `${avgAccuracy}%`;
        }

        function updateProgressStats() {
            // This function can be expanded to update more stats
            updateRanking();
        }

        function updateRanking() {
            // Simulate ranking update
            const randomRank = Math.floor(Math.random() * 100) + 1;
            document.getElementById('userRank').textContent = randomRank;
        }

        function filterSoal(filter) {
            currentFilter = filter;
            
            // Update active filter button
            document.querySelectorAll('[onclick^="filterSoal"]').forEach(btn => {
                btn.classList.remove('bg-gradient-to-r', 'from-purple-600', 'to-indigo-600', 'text-white');
                btn.classList.add('bg-slate-100', 'text-slate-700');
            });
            
            const activeBtn = document.querySelector(`[onclick="filterSoal('${filter}')"]`);
            if (activeBtn) {
                activeBtn.classList.remove('bg-slate-100', 'text-slate-700');
                activeBtn.classList.add('bg-gradient-to-r', 'from-purple-600', 'to-indigo-600', 'text-white');
            }
            
            // Filter soal cards
            const cards = document.querySelectorAll('#soalListContainer > div');
            cards.forEach(card => {
                const isCompleted = card.getAttribute('data-completed') === 'true';
                
                switch(filter) {
                    case 'completed':
                        card.style.display = isCompleted ? 'block' : 'none';
                        break;
                    case 'pending':
                        card.style.display = !isCompleted ? 'block' : 'none';
                        break;
                    default:
                        card.style.display = 'block';
                }
            });
        }

        function toggleSort() {
            isSortedAsc = !isSortedAsc;
            
            const sortButton = document.getElementById('sortButton');
            sortButton.innerHTML = isSortedAsc 
                ? '<i class="fa-solid fa-arrow-down-a-z text-slate-600"></i>'
                : '<i class="fa-solid fa-arrow-down-z-a text-slate-600"></i>';
            
            // Sort soal cards
            const container = document.getElementById('soalListContainer');
            const cards = Array.from(container.children);
            
            cards.sort((a, b) => {
                const idA = parseInt(a.getAttribute('data-id'));
                const idB = parseInt(b.getAttribute('data-id'));
                return isSortedAsc ? idA - idB : idB - idA;
            });
            
            // Reappend sorted cards
            cards.forEach(card => container.appendChild(card));
        }

        function refreshSoalList() {
            renderSoalList();
            showNotification('info', 'Memperbarui', 'Daftar tryout diperbarui');
        }

        // ========== 8. UI FUNCTIONS ==========
        function scrollToTryout() {
            const tryoutSection = document.getElementById('tryoutSection');
            if (tryoutSection) {
                tryoutSection.scrollIntoView({ behavior: 'smooth' });
                hideBottomSheet();
            }
        }

        function joinWhatsAppGroup() {
            if (!pinAkses) {
                showNotification('error', 'Gagal', 'PIN tidak tersedia');
                return;
            }
            
            const message = `Halo admin, saya peserta Paket 2 dengan PIN: ${pinAkses} mau join grup VIP`;
            const encodedMessage = encodeURIComponent(message);
            window.open(`https://wa.me/6285696409288?text=${encodedMessage}`, '_blank');
        }

        function tambahPaket() {
            if (!pinAkses) {
                showNotification('error', 'Gagal', 'PIN tidak tersedia');
                return;
            }
            
            if (!confirm('Anda akan diarahkan ke WhatsApp untuk pembelian paket tambahan (Rp 25.000). Lanjutkan?')) {
                return;
            }

            const message = `Halo Admin Kerja Jadi ASN,%0A%0ASaya ingin *Tambah 1 Paket Tryout* (Rp 25.000).%0A*PIN Peserta:* ${pinAkses}%0A*Paket:* 2 Premium%0A%0AMohon diproses informasinya. Terima kasih!`;
            window.open(`https://api.whatsapp.com/send?phone=6285696409288&text=${message}`, '_blank');
        }

        function openMateri(type) {
            if (!pinAkses) {
                showNotification('error', 'Gagal', 'PIN tidak tersedia');
                return;
            }
            
            const materiLinks = {
                'twk': 'modul-twk.html',
                'tiu': 'modul-tiu.html',
                'tkp': 'modul-tkp.html'
            };
            
            if (materiLinks[type]) {
                window.open(`${materiLinks[type]}?pin=${pinAkses}`, '_blank');
            } else {
                showNotification('info', 'Materi', 'Materi akan segera tersedia!');
            }
        }

        // ========== 9. NOTIFICATION SYSTEM ==========
        function showNotification(type, title, message) {
            const toast = document.getElementById('notification-toast');
            const toastIcon = document.getElementById('toast-icon');
            const toastTitle = document.getElementById('toast-title');
            const toastMessage = document.getElementById('toast-message');

            let iconClass;
            switch (type) {
                case 'success':
                    iconClass = 'fa-solid fa-circle-check text-green-500';
                    break;
                case 'error':
                    iconClass = 'fa-solid fa-circle-xmark text-red-500';
                    break;
                default:
                    iconClass = 'fa-solid fa-circle-info text-purple-500';
            }

            toastIcon.className = iconClass;
            toastTitle.textContent = title;
            toastMessage.textContent = message;

            toast.classList.remove('hidden');

            setTimeout(hideToast, 5000);
        }

        function hideToast() {
            document.getElementById('notification-toast').classList.add('hidden');
        }

        // ========== 10. MODAL FUNCTIONS ==========
        function showProgressModal() {
            if (!pinAkses) return;
            
            document.getElementById('modalPin').textContent = pinAkses;
            
            // Load progress content
            const progressKey = `progress_${pinAkses}`;
            const progress = JSON.parse(localStorage.getItem(progressKey)) || {};
            
            let progressHtml = '<div class="space-y-4">';
            for (let i = 1; i <= 15; i++) {
                const isCompleted = progress[`paket_${i}`] || false;
                const score = progress[`score_${i}`] || '-';
                const time = progress[`time_${i}`] || '-';
                
                progressHtml += `
                    <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                        <div>
                            <h4 class="font-bold text-slate-800">Tryout #${i}</h4>
                            <p class="text-xs text-slate-500">TWK  TIU  TKP</p>
                        </div>
                        <div class="text-right">
                            <div class="font-bold ${isCompleted ? 'text-green-600' : 'text-yellow-600'}">${score}</div>
                            <div class="text-xs text-slate-500">${time} menit</div>
                        </div>
                    </div>
                `;
            }
            progressHtml += '</div>';
            
            document.getElementById('progressContent').innerHTML = progressHtml;
            document.getElementById('progressModal').classList.remove('hidden');
        }

        function hideProgressModal() {
            document.getElementById('progressModal').classList.add('hidden');
        }

        function showRankingModal() {
            // Simulate ranking data
            const rankingHtml = `
                <div class="space-y-4">
                    <div class="text-center p-4 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl">
                        <p class="text-sm text-slate-600 mb-2">Peringkat Anda</p>
                        <div class="text-4xl font-black text-purple-600">#${document.getElementById('userRank').textContent}</div>
                        <p class="text-xs text-slate-500 mt-2">Dari 1000+ peserta Paket 2</p>
                    </div>
                    
                    <div class="space-y-2">
                        <h4 class="font-bold text-slate-800">Top 10 Ranking</h4>
                        ${Array.from({length: 10}, (_, i) => `
                            <div class="flex items-center justify-between p-3 ${i < 3 ? 'bg-gradient-to-r from-yellow-50 to-amber-50 border border-yellow-200' : 'bg-slate-50'} rounded-lg">
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 ${i < 3 ? 'bg-gradient-to-r from-yellow-500 to-amber-600 text-white' : 'bg-slate-200 text-slate-700'} rounded-full flex items-center justify-center font-bold">
                                        ${i + 1}
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-slate-800">Peserta ${String.fromCharCode(65 + i)}***</p>
                                        <p class="text-xs text-slate-500">Paket 2 Premium</p>
                                    </div>
                                </div>
                                <div class="font-bold text-slate-800">${550 - i * 5}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            document.getElementById('rankingContent').innerHTML = rankingHtml;
            document.getElementById('rankingModal').classList.remove('hidden');
        }

        function hideRankingModal() {
            document.getElementById('rankingModal').classList.add('hidden');
        }

        function showSettings() {
            const content = `
                <div class="space-y-4">
                    <h3 class="font-bold text-slate-800 text-lg mb-2">Pengaturan</h3>
                    
                    <div class="space-y-3">
                        <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                            <div>
                                <p class="text-sm font-medium text-slate-800">Mode Gelap</p>
                                <p class="text-xs text-slate-500">Tampilan gelap</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer">
                                <div class="w-11 h-6 bg-slate-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                            </label>
                        </div>
                        
                        <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                            <div>
                                <p class="text-sm font-medium text-slate-800">Notifikasi</p>
                                <p class="text-xs text-slate-500">Peringkat & pembaruan</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-slate-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                            </label>
                        </div>
                    </div>
                    
                    <button onclick="clearProgressData()" class="w-full bg-red-50 text-red-700 font-bold py-3 rounded-xl hover:bg-red-100 transition-colors mt-4">
                        <i class="fa-solid fa-trash mr-2"></i> Hapus Data Progress
                    </button>
                </div>
            `;
            
            showBottomSheet(content);
        }

        function showHelpModal() {
            const content = `
                <div class="space-y-4">
                    <h3 class="font-bold text-slate-800 text-lg mb-2">Bantuan</h3>
                    
                    <div class="space-y-3">
                        <div class="p-3 bg-blue-50 rounded-lg">
                            <h4 class="font-bold text-blue-800 text-sm mb-1">Cara Kerja Tryout</h4>
                            <p class="text-sm text-blue-700">Pilih paket tryout, kerjakan soal dengan waktu terbatas, dan dapatkan skor beserta pembahasan.</p>
                        </div>
                        
                        <div class="p-3 bg-green-50 rounded-lg">
                            <h4 class="font-bold text-green-800 text-sm mb-1">Grup WhatsApp VIP</h4>
                            <p class="text-sm text-green-700">Bergabung dengan grup untuk diskusi dengan mentor dan peserta lainnya.</p>
                        </div>
                        
                        <div class="p-3 bg-purple-50 rounded-lg">
                            <h4 class="font-bold text-purple-800 text-sm mb-1">PIN Peserta</h4>
                            <p class="text-sm text-purple-700">PIN Anda adalah identitas unik. Jangan bagikan kepada siapapun.</p>
                        </div>
                    </div>
                    
                    <div class="pt-4 border-t border-slate-200">
                        <p class="text-sm text-slate-600 mb-3">Butuh bantuan lebih lanjut?</p>
                        <button onclick="contactSupport()" class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold py-3 rounded-xl">
                            <i class="fa-brands fa-whatsapp mr-2"></i> Hubungi Support
                        </button>
                    </div>
                </div>
            `;
            
            showBottomSheet(content);
        }

        function contactSupport() {
            const message = `Halo Support Kerja Jadi ASN,%0A%0ASaya butuh bantuan untuk dashboard Paket 2.%0A*PIN Peserta:* ${pinAkses}%0A*Masalah:* [Jelaskan masalah Anda di sini]%0A%0ATerima kasih.`;
            window.open(`https://api.whatsapp.com/send?phone=6285696409288&text=${message}`, '_blank');
        }

        function clearProgressData() {
            if (!confirm('Apakah Anda yakin ingin menghapus semua data progress? Tindakan ini tidak dapat dibatalkan.')) {
                return;
            }
            
            if (!pinAkses) return;
            
            localStorage.removeItem(`progress_${pinAkses}`);
            showNotification('success', 'Berhasil', 'Data progress telah dihapus');
            hideBottomSheet();
            renderSoalList();
        }

        // ========== 11. LOGOUT FUNCTION ==========
        function confirmLogout() {
            if (!confirm('Apakah Anda yakin ingin keluar dari dashboard?')) {
                return;
            }
            
            // Clear session data
            sessionStorage.clear();
            localStorage.removeItem('pinAkses');
            localStorage.removeItem('userPin');
            
            // Clear cookies
            document.cookie = "pinAkses=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT";
            document.cookie = "paket=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT";
            
            // Redirect to login
            window.location.href = 'login.html';
        }

        // ========== 12. EVENT LISTENERS ==========
        function setupEventListeners() {
            // Close dropdowns when clicking outside
            document.addEventListener('click', (event) => {
                const profileMenu = document.getElementById('profileMenu');
                const profileButton = document.querySelector('[onclick="toggleProfileMenu()"]');

                if (profileMenu && !profileMenu.classList.contains('hidden') && 
                    !profileMenu.contains(event.target) && 
                    profileButton && !profileButton.contains(event.target)) {
                    profileMenu.classList.add('hidden');
                }

                // Close modals when clicking outside
                const modals = ['progressModal', 'rankingModal'];
                modals.forEach(modalId => {
                    const modal = document.getElementById(modalId);
                    if (modal && !modal.classList.contains('hidden')) {
                        const modalContent = modal.querySelector('div > div');
                        if (modalContent && !modalContent.contains(event.target)) {
                            modal.classList.add('hidden');
                        }
                    }
                });
            });

            // Handle escape key
            document.addEventListener('keydown', (event) => {
                if (event.key === 'Escape') {
                    hideBottomSheet();
                    hideProgressModal();
                    hideRankingModal();
                    const profileMenu = document.getElementById('profileMenu');
                    if (profileMenu && !profileMenu.classList.contains('hidden')) {
                        profileMenu.classList.add('hidden');
                    }
                }
            });

            // Prevent zoom on double tap (mobile)
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function(event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
        }

        function toggleProfileMenu() {
            const menu = document.getElementById('profileMenu');
            menu.classList.toggle('hidden');
        }

        // Initialize layout
        setTimeout(updateLayout, 100);
    </script>
</body>
</html>