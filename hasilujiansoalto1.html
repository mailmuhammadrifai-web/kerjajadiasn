<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hasil Ujian SKD - CAT ASN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: #f8fafc;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .status-pass { color: #16a34a; background: #f0fdf4; border: 1px solid #bbf7d0; }
        .status-fail { color: #dc2626; background: #fef2f2; border: 1px solid #fecaca; }
        .progress-ring { transition: stroke-dashoffset 0.35s; transform: rotate(-90deg); transform-origin: 50% 50%; }
    </style>
</head>
<body class="min-h-screen pb-12">

    <header class="bg-white border-b border-slate-200 py-4 sticky top-0 z-50 shadow-sm">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <div class="bg-blue-600 text-white p-2 rounded-lg">
                    <i class="fa-solid fa-chart-column"></i>
                </div>
                <div>
                    <h1 class="font-extrabold text-slate-800 text-lg leading-none">HASIL UJIAN</h1>
                    <p class="text-xs text-slate-500 font-bold uppercase mt-1 tracking-widest">SKD CAT ASN - PAKET 1</p>
                </div>
            </div>
            <div class="text-right">
                <p class="text-[10px] text-slate-500 font-bold uppercase">ID Peserta</p>
                <p id="displayPIN" class="font-mono font-black text-blue-600 text-sm md:text-base">------</p>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <div class="lg:col-span-1 bg-white rounded-3xl p-8 shadow-sm border border-slate-200 flex flex-col items-center justify-center text-center">
                <div class="relative w-48 h-48 mb-6">
                    <svg class="w-full h-full">
                        <circle cx="96" cy="96" r="88" stroke="#e2e8f0" stroke-width="12" fill="transparent" />
                        <circle id="totalCircle" cx="96" cy="96" r="88" stroke="#3b82f6" stroke-width="12" fill="transparent" 
                                stroke-dasharray="552.92" stroke-dashoffset="552.92" class="progress-ring" stroke-linecap="round" />
                    </svg>
                    <div class="absolute inset-0 flex flex-col items-center justify-center">
                        <span id="totalSkor" class="text-5xl font-black text-slate-800">0</span>
                        <span class="text-xs font-bold text-slate-400 uppercase tracking-widest">Dari 550</span>
                    </div>
                </div>
                <div id="statusBadge" class="px-6 py-2 rounded-full font-extrabold text-sm uppercase tracking-widest mb-4">
                    MENGEVALUASI...
                </div>
                <p id="statusNote" class="text-slate-500 text-sm leading-relaxed">
                    Sistem sedang menghitung skor Anda berdasarkan passing grade terbaru.
                </p>
            </div>

            <div class="lg:col-span-2 grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
                    <div class="flex justify-between items-start mb-4">
                        <span class="w-10 h-10 rounded-xl bg-blue-50 text-blue-600 flex items-center justify-center font-bold">TWK</span>
                        <span id="twkStatus" class="text-[10px] font-black px-2 py-1 rounded-md uppercase">--</span>
                    </div>
                    <h3 class="text-slate-500 text-xs font-bold uppercase mb-1">Skor Diperoleh</h3>
                    <p class="text-3xl font-black text-slate-800 mb-4"><span id="skorTWK">0</span><span class="text-sm text-slate-400">/150</span></p>
                    <div class="space-y-2">
                        <div class="flex justify-between text-xs font-bold">
                            <span class="text-slate-400 uppercase">Ambang Batas</span>
                            <span class="text-slate-600">65</span>
                        </div>
                        <div class="w-full bg-slate-100 h-1.5 rounded-full overflow-hidden">
                            <div id="barTWK" class="h-full bg-blue-500" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
                    <div class="flex justify-between items-start mb-4">
                        <span class="w-10 h-10 rounded-xl bg-emerald-50 text-emerald-600 flex items-center justify-center font-bold">TIU</span>
                        <span id="tiuStatus" class="text-[10px] font-black px-2 py-1 rounded-md uppercase">--</span>
                    </div>
                    <h3 class="text-slate-500 text-xs font-bold uppercase mb-1">Skor Diperoleh</h3>
                    <p class="text-3xl font-black text-slate-800 mb-4"><span id="skorTIU">0</span><span class="text-sm text-slate-400">/175</span></p>
                    <div class="space-y-2">
                        <div class="flex justify-between text-xs font-bold">
                            <span class="text-slate-400 uppercase">Ambang Batas</span>
                            <span class="text-slate-600">80</span>
                        </div>
                        <div class="w-full bg-slate-100 h-1.5 rounded-full overflow-hidden">
                            <div id="barTIU" class="h-full bg-emerald-500" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
                    <div class="flex justify-between items-start mb-4">
                        <span class="w-10 h-10 rounded-xl bg-purple-50 text-purple-600 flex items-center justify-center font-bold">TKP</span>
                        <span id="tkpStatus" class="text-[10px] font-black px-2 py-1 rounded-md uppercase">--</span>
                    </div>
                    <h3 class="text-slate-500 text-xs font-bold uppercase mb-1">Skor Diperoleh</h3>
                    <p class="text-3xl font-black text-slate-800 mb-4"><span id="skorTKP">0</span><span class="text-sm text-slate-400">/225</span></p>
                    <div class="space-y-2">
                        <div class="flex justify-between text-xs font-bold">
                            <span class="text-slate-400 uppercase">Ambang Batas</span>
                            <span class="text-slate-600">166</span>
                        </div>
                        <div class="w-full bg-slate-100 h-1.5 rounded-full overflow-hidden">
                            <div id="barTKP" class="h-full bg-purple-500" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex flex-col md:flex-row gap-4 mb-12">
            <button onclick="handleDashboardRedirect()" class="flex-1 bg-slate-800 text-white py-4 rounded-2xl font-bold hover:bg-slate-900 transition-all flex items-center justify-center gap-3 shadow-lg shadow-slate-200">
                <i class="fa-solid fa-house"></i>
                Kembali ke Dashboard
            </button>
            <button onclick="document.getElementById('pembahasanSection').scrollIntoView({behavior:'smooth'})" class="flex-1 bg-white text-blue-600 border-2 border-blue-600 py-4 rounded-2xl font-bold hover:bg-blue-50 transition-all flex items-center justify-center gap-3">
                <i class="fa-solid fa-book-open-reader"></i>
                Lihat Pembahasan Soal
            </button>
        </div>

        <div id="pembahasanSection" class="space-y-6">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-2xl font-black text-slate-800 flex items-center gap-3">
                    <span class="bg-blue-600 w-2 h-8 rounded-full"></span>
                    Pembahasan Soal
                </h2>
                <div class="flex gap-2">
                    <select id="filterKategori" onchange="renderPembahasan()" class="bg-white border border-slate-200 rounded-xl px-4 py-2 text-sm font-bold text-slate-600 outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="ALL">Semua Kategori</option>
                        <option value="TWK">TWK (Tes Wawasan Kebangsaan)</option>
                        <option value="TIU">TIU (Tes Intelegensia Umum)</option>
                        <option value="TKP">TKP (Tes Karakteristik Pribadi)</option>
                    </select>
                </div>
            </div>

            <div id="containerPembahasan" class="grid grid-cols-1 gap-6">
                </div>
        </div>
    </main>

    <script>
        // ====================== KONFIGURASI ======================
        const PASSING_GRADE = {
            TWK: 65,
            TIU: 80,
            TKP: 166,
            TOTAL: 311
        };

        const pinDatabase = {
            "paket1": ["7XK9WP", "B4ZM1Q", "9TV2NL", "RS8MX3", "5CR1VT", "KP9MZ4", "G6HD2S", "1VT8NR", "FN2VK5", "2YM4BX", "MR2VT8", "5HG9SL", "XP3KZ7", "2YN5VQ", "8WQ4PZ", "VS7NL2"],
            "paket2": ["9ZW1RF", "4FB6NT", "7XK1WP", "B2MK9P", "LP9QX4", "Y7CR2V", "4FB8NR", "9TW1MZ", "SK3JP7", "1VT5NR", "FN9VK3", "2YM7BX", "SK9JP4", "MR7VT1", "3ZW7RB", "KP1MX9", "G6HD1S"],
            "paket3": ["VS4NL8", "RT9XM2", "B2MK8P", "7XL1WQ", "5HG2SD", "9ZW4RB", "KP8MX3", "FN5VK2", "8WQ4PZ", "2YM9BX", "7KP1RT", "5HG6SD", "9ZW3RF", "RS4ML9", "VN7VK1", "8WQ3PZ", "4FB1NT"]
        };

        // Mengambil data dari localStorage yang disimpan oleh soalto1.html
        const rawData = localStorage.getItem('ujian_progress_1');
        const bankSoalData = JSON.parse(localStorage.getItem('bankSoal_1')) || []; // Idealnya bank soal juga disimpan di storage atau di-include
        
        // Data Fallback jika bank soal tidak ada di storage (Integrasi dengan bankSoal dari soalto1.html)
        // Karena bank soal panjang, di dunia nyata ini akan di-fetch dari API atau file terpisah (pembahasansoalto1.html)
        
        let userProgress = rawData ? JSON.parse(rawData) : { id: "GUEST", jawaban: [] };
        let userPIN = userProgress.id || "TIDAK ADA PIN";
        document.getElementById('displayPIN').innerText = userPIN;

        // ====================== LOGIKA PERHITUNGAN ======================
        function hitungSkor() {
            let skor = { TWK: 0, TIU: 0, TKP: 0, total: 0 };
            
            // Dummy logic: Dalam realitas, loop bankSoal untuk mencocokkan kunci
            // Kita asumsikan bankSoal dikirim via storage atau variabel global
            // Index: 0-29 TWK, 30-64 TIU, 65-109 TKP
            
            // Contoh simulasi perhitungan:
            userProgress.jawaban.forEach((jawaban, idx) => {
                if (idx < 30) { // TWK
                    if (jawaban === 1) skor.TWK += 5; // Asumsi kunci index 1
                } else if (idx < 65) { // TIU
                    if (jawaban === 2) skor.TIU += 5; // Asumsi kunci index 2
                } else { // TKP
                    // TKP biasanya 1-5 poin
                    skor.TKP += (jawaban !== null ? Math.floor(Math.random() * 5) + 1 : 0);
                }
            });

            skor.total = skor.TWK + skor.TIU + skor.TKP;
            return skor;
        }

        function updateUI(skor) {
            // Update Teks
            document.getElementById('skorTWK').innerText = skor.TWK;
            document.getElementById('skorTIU').innerText = skor.TIU;
            document.getElementById('skorTKP').innerText = skor.TKP;
            document.getElementById('totalSkor').innerText = skor.total;

            // Update Bars
            document.getElementById('barTWK').style.width = (skor.TWK / 150 * 100) + '%';
            document.getElementById('barTIU').style.width = (skor.TIU / 175 * 100) + '%';
            document.getElementById('barTKP').style.width = (skor.TKP / 225 * 100) + '%';

            // Circular Progress
            const circle = document.getElementById('totalCircle');
            const radius = circle.r.baseVal.value;
            const circumference = radius * 2 * Math.PI;
            const offset = circumference - (skor.total / 550 * circumference);
            circle.style.strokeDashoffset = offset;

            // Check Pass/Fail
            const isTWKPass = skor.TWK >= PASSING_GRADE.TWK;
            const isTIUPass = skor.TIU >= PASSING_GRADE.TIU;
            const isTKPPass = skor.TKP >= PASSING_GRADE.TKP;
            const isTotalPass = isTWKPass && isTIUPass && isTKPPass;

            const updateStatus = (id, isPass) => {
                const el = document.getElementById(id);
                el.innerText = isPass ? 'LULUS PG' : 'TIDAK LULUS';
                el.className = `text-[10px] font-black px-2 py-1 rounded-md uppercase ${isPass ? 'status-pass' : 'status-fail'}`;
            };

            updateStatus('twkStatus', isTWKPass);
            updateStatus('tiuStatus', isTIUPass);
            updateStatus('tkpStatus', isTKPPass);

            const badge = document.getElementById('statusBadge');
            const note = document.getElementById('statusNote');
            
            if (isTotalPass) {
                badge.innerText = 'MEMENUHI AMBANG BATAS';
                badge.className = 'px-6 py-2 rounded-full font-extrabold text-sm uppercase tracking-widest mb-4 status-pass';
                note.innerText = 'Selamat! Anda berhasil melewati seluruh ambang batas SKD. Pertahankan performa Anda!';
            } else {
                badge.innerText = 'TIDAK MEMENUHI AMBANG BATAS';
                badge.className = 'px-6 py-2 rounded-full font-extrabold text-sm uppercase tracking-widest mb-4 status-fail';
                note.innerText = 'Jangan menyerah! Anda masih perlu meningkatkan skor di kategori yang belum mencapai ambang batas.';
            }
        }

        // ====================== NAVIGASI DASHBOARD ======================
        function handleDashboardRedirect() {
            let targetPage = "index.html"; // Default

            if (pinDatabase.paket1.includes(userPIN)) {
                targetPage = "dashboardpaket1.html";
            } else if (pinDatabase.paket2.includes(userPIN)) {
                targetPage = "dashboardpaket2.html";
            } else if (pinDatabase.paket3.includes(userPIN)) {
                targetPage = "dashboardpaket3.html";
            }

            window.location.href = targetPage;
        }

        // ====================== RENDER PEMBAHASAN ======================
        function renderPembahasan() {
            const container = document.getElementById('containerPembahasan');
            const filter = document.getElementById('filterKategori').value;
            container.innerHTML = '';

            // Dummy Data Pembahasan (Sebagai representasi pembahasansoalto1.html)
            const mockSoal = [
                { id: 1, kategori: "TWK", tanya: "Proklamasi Kemerdekaan Indonesia mengandung nilai universal yang berarti...", opsi: ["A", "B", "C", "D", "E"], kunci: 1, pembahasan: "Nilai universal berarti berlaku untuk siapa saja dan di mana saja, menjadi inspirasi bangsa lain." },
                { id: 31, kategori: "TIU", tanya: "ANOMALI â‰ˆ", opsi: ["A", "B", "C", "D", "E"], kunci: 2, pembahasan: "Anomali adalah penyimpangan dari normal atau kelaziman." },
                { id: 66, kategori: "TKP", tanya: "Jika Anda melihat rekan kerja yang sedang kesulitan...", opsi: ["A", "B", "C", "D", "E"], kunci: [5, 4, 1, 3, 2], pembahasan: "Aspek jejaring kerja menuntut empati dan bantuan proaktif kepada rekan sejawat." }
            ];

            mockSoal.forEach(s => {
                if (filter !== 'ALL' && s.kategori !== filter) return;

                const card = document.createElement('div');
                card.className = 'bg-white rounded-2xl p-6 border border-slate-200 shadow-sm';
                
                let userAns = userProgress.jawaban[s.id - 1];
                let isCorrect = (s.kategori === 'TKP') ? true : (userAns === s.kunci);

                card.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <span class="px-3 py-1 bg-slate-100 rounded-lg text-xs font-bold text-slate-500">Soal #${s.id} - ${s.kategori}</span>
                        ${isCorrect ? 
                            '<span class="text-emerald-600 font-bold text-sm flex items-center gap-1"><i class="fa-solid fa-circle-check"></i> Benar</span>' : 
                            '<span class="text-red-600 font-bold text-sm flex items-center gap-1"><i class="fa-solid fa-circle-xmark"></i> Salah</span>'}
                    </div>
                    <p class="text-slate-800 font-medium mb-4">${s.tanya}</p>
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-xl mb-2">
                        <p class="text-xs font-bold text-blue-700 uppercase mb-1">Pembahasan:</p>
                        <p class="text-sm text-blue-900 leading-relaxed">${s.pembahasan}</p>
                    </div>
                    <div class="flex gap-4 mt-4">
                        <div class="text-[10px] font-bold uppercase">
                            <p class="text-slate-400">Jawaban Anda</p>
                            <p class="${isCorrect ? 'text-emerald-600' : 'text-red-600'}">${userAns !== null ? String.fromCharCode(65 + userAns) : 'Tidak Menjawab'}</p>
                        </div>
                        <div class="text-[10px] font-bold uppercase">
                            <p class="text-slate-400">Kunci Jawaban</p>
                            <p class="text-slate-800">${s.kategori === 'TKP' ? 'Skala 1-5' : String.fromCharCode(65 + s.kunci)}</p>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Initialize
        window.onload = () => {
            const skor = hitungSkor();
            updateUI(skor);
            renderPembahasan();
        };
    </script>
</body>
</html>
