<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hasil Ujian SKD - Tryout Online</title>
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #64748b;
            --success: #22c55e;
            --danger: #ef4444;
            --warning: #f59e0b;
            --background: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--background);
            color: var(--text-main);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        /* Header Section */
        header {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 6px solid var(--primary);
        }

        .header-info h1 {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .pin-badge {
            background: #dbeafe;
            color: var(--primary);
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: bold;
            font-family: monospace;
            font-size: 1.1rem;
        }

        /* Result Cards Grid */
        .grid-scores {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .card {
            background: var(--card-bg);
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            text-align: center;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .card h3 {
            color: var(--text-muted);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .score-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .passing-info {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        /* Status Badge */
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: bold;
            margin-top: 10px;
            text-transform: uppercase;
        }

        .status-pass { background: #dcfce7; color: #166534; }
        .status-fail { background: #fee2e2; color: #991b1b; }

        /* Progress Bar */
        .progress-container {
            background: #f1f5f9;
            height: 8px;
            border-radius: 4px;
            margin-top: 15px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            border-radius: 4px;
            transition: width 1s ease-in-out;
        }

        /* Summary Section */
        .summary-box {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            text-align: center;
            margin-bottom: 30px;
        }

        .total-label { font-size: 1.1rem; color: var(--text-muted); }
        .total-score { font-size: 4rem; font-weight: 900; color: var(--text-main); line-height: 1; margin: 10px 0;}
        
        .final-status {
            font-size: 1.5rem;
            font-weight: bold;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        /* Buttons */
        .action-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            flex: 1;
            padding: 15px 25px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            font-size: 1rem;
        }

        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: #1d4ed8; transform: translateY(-2px); }

        .btn-outline { 
            background: transparent; 
            color: var(--text-main); 
            border: 2px solid var(--border);
        }
        .btn-outline:hover { background: #f1f5f9; }

        /* Error Message */
        #error-screen {
            display: none;
            text-align: center;
            padding: 100px 20px;
        }

        .error-icon { font-size: 4rem; color: var(--danger); margin-bottom: 20px; }

        @media (max-width: 600px) {
            header { flex-direction: column; text-align: center; gap: 10px; }
            .total-score { font-size: 3rem; }
            .btn { flex: none; width: 100%; }
        }
    </style>
</head>
<body>

    <div id="main-content" class="container">
        <header>
            <div class="header-info">
                <h1>Hasil Tryout SKD #1</h1>
                <p id="current-date"></p>
            </div>
            <div class="pin-badge" id="display-pin">PIN: ------</div>
        </header>

        <div class="summary-box">
            <p class="total-label">Total Skor Akhir</p>
            <div class="total-score" id="total-skd">0</div>
            <div id="final-status-badge" class="final-status">MEMPROSES...</div>
            <p id="passing-desc" class="text-muted"></p>
        </div>

        <div class="grid-scores">
            <div class="card">
                <h3>Tes Wawasan Kebangsaan</h3>
                <div class="score-value" id="score-twk">0</div>
                <p class="passing-info">Passing Grade: 65</p>
                <div id="status-twk" class="status-badge">Checking</div>
                <div class="progress-container">
                    <div id="bar-twk" class="progress-bar" style="width: 0%; background: var(--primary);"></div>
                </div>
            </div>

            <div class="card">
                <h3>Tes Intelegensia Umum</h3>
                <div class="score-value" id="score-tiu">0</div>
                <p class="passing-info">Passing Grade: 80</p>
                <div id="status-tiu" class="status-badge">Checking</div>
                <div class="progress-container">
                    <div id="bar-tiu" class="progress-bar" style="width: 0%; background: var(--primary);"></div>
                </div>
            </div>

            <div class="card">
                <h3>Tes Karakteristik Pribadi</h3>
                <div class="score-value" id="score-tkp">0</div>
                <p class="passing-info">Passing Grade: 166</p>
                <div id="status-tkp" class="status-badge">Checking</div>
                <div class="progress-container">
                    <div id="bar-tkp" class="progress-bar" style="width: 0%; background: var(--primary);"></div>
                </div>
            </div>
        </div>

        <div class="action-group">
            <a href="pembahasansoalto1.html" class="btn btn-primary">
                Lihat Pembahasan Soal
            </a>
            <button onclick="redirectToDashboard()" class="btn btn-outline">
                Kembali ke Dashboard
            </button>
        </div>
    </div>

    <div id="error-screen" class="container">
        <div class="error-icon">⚠️</div>
        <h2>Data Tidak Ditemukan</h2>
        <p>Maaf, kami tidak menemukan data pengerjaan ujian atau sesi Anda telah berakhir.</p>
        <br>
        <a href="index.html" class="btn btn-primary">Kembali ke Beranda</a>
    </div>

    <script>
        // Database PIN untuk mapping dashboard
        const pinDatabase = {
            "paket1": ["7XK9WP", "B4ZM1Q", "9TV2NL", "RS8MX3", "5CR1VT", "KP9MZ4", "G6HD2S", "1VT8NR", "FN2VK5", "2YM4BX", "MR2VT8", "5HG9SL", "XP3KZ7", "2YN5VQ", "8WQ4PZ", "VS7NL2"],
            "paket2": ["9ZW1RF", "4FB6NT", "7XK1WP", "B2MK9P", "LP9QX4", "Y7CR2V", "4FB8NR", "9TW1MZ", "SK3JP7", "1VT5NR", "FN9VK3", "2YM7BX", "SK9JP4", "MR7VT1", "3ZW7RB", "KP1MX9", "G6HD1S"],
            "paket3": ["VS4NL8", "RT9XM2", "B2MK8P", "7XL1WQ", "5HG2SD", "9ZW4RB", "KP8MX3", "FN5VK2", "8WQ4PZ", "2YM9BX", "7KP1RT", "5HG6SD", "9ZW3RF", "RS4ML9", "VN7VK1", "8WQ3PZ", "4FB1NT"]
        };

        // Ambil data dari localStorage
        // Catatan: Pastikan di soalto1.html, data ini disimpan dengan kunci yang sama
        const userPin = localStorage.getItem('user_pin') || "";
        const nilaiTWK = parseInt(localStorage.getItem('score_twk')) || 0;
        const nilaiTIU = parseInt(localStorage.getItem('score_tiu')) || 0;
        const nilaiTKP = parseInt(localStorage.getItem('score_tkp')) || 0;
        const totalNilai = nilaiTWK + nilaiTIU + nilaiTKP;

        // Syarat Passing Grade
        const PG = {
            twk: 65,
            tiu: 80,
            tkp: 166,
            total: 311
        };

        // Maksimal Poin (untuk Progress Bar)
        const MAX = {
            twk: 150,
            tiu: 175,
            tkp: 225,
            total: 550
        };

        window.onload = function() {
            // Validasi data sederhana
            if (!userPin && totalNilai === 0) {
                document.getElementById('main-content').style.display = 'none';
                document.getElementById('error-screen').style.display = 'block';
                return;
            }

            // Set Tanggal
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('current-date').innerText = new Date().toLocaleDateString('id-ID', options);

            // Tampilkan PIN
            document.getElementById('display-pin').innerText = "PIN: " + userPin;

            // Render Nilai dan Status
            displayResult('twk', nilaiTWK, PG.twk, MAX.twk);
            displayResult('tiu', nilaiTIU, PG.tiu, MAX.tiu);
            displayResult('tkp', nilaiTKP, PG.tkp, MAX.tkp);

            // Total Score Logic
            document.getElementById('total-skd').innerText = totalNilai;
            
            const isPassTWK = nilaiTWK >= PG.twk;
            const isPassTIU = nilaiTIU >= PG.tiu;
            const isPassTKP = nilaiTKP >= PG.tkp;
            const isPassTotal = totalNilai >= PG.total;

            const finalBadge = document.getElementById('final-status-badge');
            const desc = document.getElementById('passing-desc');

            if (isPassTWK && isPassTIU && isPassTKP && isPassTotal) {
                finalBadge.innerText = "SELAMAT! ANDA LULUS PG";
                finalBadge.style.backgroundColor = "#dcfce7";
                finalBadge.style.color = "#166534";
                desc.innerText = "Skor Anda telah memenuhi semua ambang batas nilai SKD resmi.";
            } else {
                finalBadge.innerText = "TIDAK LULUS PASSING GRADE";
                finalBadge.style.backgroundColor = "#fee2e2";
                finalBadge.style.color = "#991b1b";
                desc.innerText = "Maaf, skor Anda belum memenuhi satu atau lebih ambang batas nilai SKD.";
            }
        };

        function displayResult(id, score, pg, max) {
            const element = document.getElementById('score-' + id);
            const statusEl = document.getElementById('status-' + id);
            const barEl = document.getElementById('bar-' + id);
            
            element.innerText = score;
            
            // Persentase Progress Bar
            const percent = (score / max) * 100;
            setTimeout(() => {
                barEl.style.width = percent + "%";
            }, 200);

            if (score >= pg) {
                statusEl.innerText = "LULUS";
                statusEl.classList.add('status-pass');
                barEl.style.backgroundColor = "var(--success)";
            } else {
                statusEl.innerText = "TIDAK LULUS";
                statusEl.classList.add('status-fail');
                barEl.style.backgroundColor = "var(--danger)";
            }
        }

        function redirectToDashboard() {
            let targetPage = "index.html"; // Default fallback
            let pinFound = false;

            for (const [paket, pins] of Object.entries(pinDatabase)) {
                if (pins.includes(userPin.toUpperCase())) {
                    targetPage = `dashboard${paket}.html`;
                    pinFound = true;
                    break;
                }
            }

            if (!pinFound) {
                alert("PIN tidak valid untuk redirect dashboard. Kembali ke halaman utama.");
            }
            
            window.location.href = targetPage;
        }
    </script>
</body>
</html>
